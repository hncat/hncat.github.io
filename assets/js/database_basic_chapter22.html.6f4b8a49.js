"use strict";(self.webpackChunkfar_blog=self.webpackChunkfar_blog||[]).push([[9266],{6262:(i,s)=>{s.A=(i,s)=>{const a=i.__vccOpts||i;for(const[i,n]of s)a[i]=n;return a}},8422:(i,s,a)=>{a.r(s),a.d(s,{comp:()=>t,data:()=>h});var n=a(641);const l=[(0,n.Fv)('<h2 id="_22-1-游标" tabindex="-1"><a class="header-anchor" href="#_22-1-游标"><span>22.1 游标</span></a></h2><div class="hint-container important"><p class="hint-container-title">重要</p><p>游标（cursor）是一个存储在MySQL服务器上的数据库查询，它不是一条SELECT语句，而是被该语句检索出来的结果集。在存储了游标之后，应用程序可以根据需要滚动或浏览其中的数据。</p></div><blockquote><p>[!node]<br> 只能用于存储过程 不像多数DBMS，MySQL游标只能用于存储过程（和函数）。</p></blockquote><h2 id="_22-2-使用游标" tabindex="-1"><a class="header-anchor" href="#_22-2-使用游标"><span>22.2 使用游标</span></a></h2><ol><li>在能够使用游标前，必须声明（定义）它。这个过程实际上没有检索数据，它只是定义要使用的SELECT语句。</li><li>一旦声明后，必须打开游标以供使用。这个过程用前面定义的SELECT语句把数据实际检索出来。</li><li>对于填有数据的游标，根据需要取出（检索）各行。</li><li>在结束游标使用时，必须关闭游标。</li></ol><h3 id="_22-2-1-创建游标" tabindex="-1"><a class="header-anchor" href="#_22-2-1-创建游标"><span>22.2.1 创建游标</span></a></h3><div class="hint-container important"><p class="hint-container-title">重要</p><p>游标用DECLARE语句创建。DECLARE命名游标，并定义相应的SELECT语句，根据需要带WHERE和其他子句。</p></div><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> PROCEDURE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> processorders()</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">BEGIN</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  DECLARE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ordernumbers </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">CURSOR</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> -- DECLARE语句用来定义和命名游标，这里为ordernumbers。</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  FOR</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> order_num </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> orders;</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">END</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_22-2-2-打开和关闭游标" tabindex="-1"><a class="header-anchor" href="#_22-2-2-打开和关闭游标"><span>22.2.2 打开和关闭游标</span></a></h3><div class="hint-container important"><p class="hint-container-title">重要</p><p>游标用OPEN打开，CLOSE关闭</p></div><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">OPEN</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ordernumbers; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 打开游标</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">CLOSE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ordernumbers; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 关闭游标</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> PROCEDURE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> processorders()</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">BEGIN</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  DECLARE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ordernumbers </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">CURSOR</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> -- DECLARE语句用来定义和命名游标，这里为ordernumbers。</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  FOR</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> order_num </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> orders;</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  -- Open the cursor</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  OPEN</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ordernumbers;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  -- Close the cursor</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  CLOSE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ordernumbers;</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">END</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>隐含关闭 如果你不明确关闭游标，MySQL将会在到达END语句时自动关闭它。</p></div><h3 id="_22-2-3-使用游标" tabindex="-1"><a class="header-anchor" href="#_22-2-3-使用游标"><span>22.2.3 使用游标</span></a></h3><div class="hint-container important"><p class="hint-container-title">重要</p><p>在一个游标被打开后，可以使用FETCH语句分别访问它的每一行。FETCH指定检索什么数据（所需的列），检索出来的数据存储在什么地方。它还向前移动游标中的内部行指针，使下一条FETCH语句检索下一行（不重复读取同一行）。</p></div><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> PROCEDURE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> processorders()</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">BEGIN</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  -- Declare local variables</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  DECLARE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> done </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">BOOLEAN</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  DECLARE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> o </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">INT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  DECLARE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ordernumbers </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">CURSOR</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> -- DECLARE语句用来定义和命名游标，这里为ordernumbers。</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  FOR</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> order_num </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> orders;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  -- Declare continue handler</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  -- 这条语句定义了一个CONTINUE HANDLER，它是在条件出现时被执行的代码</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  -- 当SQLSTATE &#39;02000&#39;出现时，SET done=1。SQLSTATE &#39;02000&#39;是一个未找到条件，当REPEAT由于没有更多的行供循环而不能继续时，出现这个条件。</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  DECLARE</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> CONTINUE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> HANDLER </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FOR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> SQLSTATE </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;02000&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> SET</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> done </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  -- Open the cursor</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  OPEN</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ordernumbers;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  -- Loop through all rows</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  REPEAT</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    -- Get order number</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    -- 中FETCH用来检索当前行的order_num列（将自动从第一行开始）到一个名为o的局部声明的变量中。对检索出的数据不做任何处理。</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    FETCH</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ordernumbers </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> o;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  UNTIL done </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">END</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> REPEAT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  -- Close the cursor</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  CLOSE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ordernumbers;</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">END</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',15)],e={},t=(0,a(6262).A)(e,[["render",function(i,s){return(0,n.uX)(),(0,n.CE)("div",null,l)}]]),h=JSON.parse('{"path":"/database/basic/chapter22.html","title":"第二十二章 游标","lang":"zh-CN","frontmatter":{"title":"第二十二章 游标","date":"2025-08-24T00:00:00.000Z","tags":["计算机基础","数据库"],"categories":"mysql","isOriginal":true,"order":23,"dir":{"order":23},"description":"22.1 游标 重要 游标（cursor）是一个存储在MySQL服务器上的数据库查询，它不是一条SELECT语句，而是被该语句检索出来的结果集。在存储了游标之后，应用程序可以根据需要滚动或浏览其中的数据。 [!node] 只能用于存储过程 不像多数DBMS，MySQL游标只能用于存储过程（和函数）。 22.2 使用游标 在能够使用游标前，必须声明（定义...","head":[["meta",{"property":"og:url","content":"https://hncat.github.io/database/basic/chapter22.html"}],["meta",{"property":"og:site_name","content":"far"}],["meta",{"property":"og:title","content":"第二十二章 游标"}],["meta",{"property":"og:description","content":"22.1 游标 重要 游标（cursor）是一个存储在MySQL服务器上的数据库查询，它不是一条SELECT语句，而是被该语句检索出来的结果集。在存储了游标之后，应用程序可以根据需要滚动或浏览其中的数据。 [!node] 只能用于存储过程 不像多数DBMS，MySQL游标只能用于存储过程（和函数）。 22.2 使用游标 在能够使用游标前，必须声明（定义..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-08-27T14:41:37.000Z"}],["meta",{"property":"article:author","content":"Mr.far"}],["meta",{"property":"article:tag","content":"计算机基础"}],["meta",{"property":"article:tag","content":"数据库"}],["meta",{"property":"article:published_time","content":"2025-08-24T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-08-27T14:41:37.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"第二十二章 游标\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2025-08-24T00:00:00.000Z\\",\\"dateModified\\":\\"2025-08-27T14:41:37.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Mr.far\\",\\"url\\":\\"https://hncat.github.io\\"}]}"]]},"headers":[{"level":2,"title":"22.1 游标","slug":"_22-1-游标","link":"#_22-1-游标","children":[]},{"level":2,"title":"22.2 使用游标","slug":"_22-2-使用游标","link":"#_22-2-使用游标","children":[{"level":3,"title":"22.2.1 创建游标","slug":"_22-2-1-创建游标","link":"#_22-2-1-创建游标","children":[]},{"level":3,"title":"22.2.2 打开和关闭游标","slug":"_22-2-2-打开和关闭游标","link":"#_22-2-2-打开和关闭游标","children":[]},{"level":3,"title":"22.2.3 使用游标","slug":"_22-2-3-使用游标","link":"#_22-2-3-使用游标","children":[]}]}],"git":{"createdTime":1756101952000,"updatedTime":1756305697000,"contributors":[{"name":"far","email":"v19991123v@163.com","commits":2}]},"readingTime":{"minutes":2.37,"words":710},"filePathRelative":"database/basic/chapter22.md","localizedDate":"2025年8月24日","excerpt":"<h2>22.1 游标</h2>\\n<div class=\\"hint-container important\\">\\n<p class=\\"hint-container-title\\">重要</p>\\n<p>游标（cursor）是一个存储在MySQL服务器上的数据库查询，它不是一条SELECT语句，而是被该语句检索出来的结果集。在存储了游标之后，应用程序可以根据需要滚动或浏览其中的数据。</p>\\n</div>\\n<blockquote>\\n<p>[!node]<br>\\n只能用于存储过程 不像多数DBMS，MySQL游标只能用于存储过程（和函数）。</p>\\n</blockquote>\\n<h2>22.2 使用游标</h2>","autoDesc":true}')}}]);