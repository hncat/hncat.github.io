<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.50" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://hncat.github.io/cs/linker/chapter05.html"><meta property="og:site_name" content="far"><meta property="og:title" content="ç¬¬äº”ç«  åŠ¨æ€é“¾æ¥"><meta property="og:description" content="1. ä»€ä¹ˆæ˜¯åŠ¨æ€é“¾æ¥ é‡è¦ æŠŠé“¾æ¥çš„è¿‡ç¨‹æ¨è¿Ÿåˆ°è¿è¡Œæ—¶è¿›è¡Œï¼Œè¿™å°±æ˜¯åŠ¨æ€é“¾æ¥(Dynamic Linking)çš„åŸºæœ¬æ€æƒ³ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¨‹åºä¸åŠ¨æ€åº“ä¹‹é—´çœŸæ­£çš„é“¾æ¥å·¥ä½œæ˜¯ç”±åŠ¨æ€é“¾æ¥å™¨å®Œæˆçš„ï¼Œè€Œä¸é™æ€é“¾æ¥å™¨ldå®Œæˆã€‚ 2. ç®€å•çš„åŠ¨æ€é“¾æ¥ä¾‹å­ ä½¿ç”¨GCCå°†Lib.cç¼–è¯‘æˆä¸€ä¸ªå…±äº«å¯¹è±¡æ–‡ä»¶: åŠ¨æ€é“¾æ¥è¿‡ç¨‹åŠ¨æ€é“¾æ¥è¿‡ç¨‹ é‡è¦ Lib.cè¢«é“¾æ¥æˆLib.soå…±äº«å¯¹..."><meta property="og:type" content="article"><meta property="og:image" content="https://hncat.github.io/image/linker/chapter05/åŠ¨æ€é“¾æ¥è¿‡ç¨‹.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-07-16T08:31:53.000Z"><meta property="article:author" content="Mr.far"><meta property="article:tag" content="è®¡ç®—æœºåŸºç¡€"><meta property="article:tag" content="c/c++"><meta property="article:published_time" content="2024-07-08T00:00:00.000Z"><meta property="article:modified_time" content="2024-07-16T08:31:53.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"ç¬¬äº”ç«  åŠ¨æ€é“¾æ¥","image":["https://hncat.github.io/image/linker/chapter05/åŠ¨æ€é“¾æ¥è¿‡ç¨‹.png","https://hncat.github.io/image/linker/chapter05/æ¨¡å—é—´æ•°æ®è®¿é—®.png","https://hncat.github.io/image/linker/chapter05/æ¨¡å—é—´è°ƒç”¨ã€è·³è½¬.png","https://hncat.github.io/image/linker/chapter05/got&plt.png","https://hncat.github.io/image/linker/chapter05/è¾…åŠ©ä¿¡æ¯1.png","https://hncat.github.io/image/linker/chapter05/è¾…åŠ©ä¿¡æ¯2.png"],"datePublished":"2024-07-08T00:00:00.000Z","dateModified":"2024-07-16T08:31:53.000Z","author":[{"@type":"Person","name":"Mr.far","url":"https://hncat.github.io"}]}</script><link rel="icon" href="/far-logo.png"><title>ç¬¬äº”ç«  åŠ¨æ€é“¾æ¥ | far</title><meta name="description" content="1. ä»€ä¹ˆæ˜¯åŠ¨æ€é“¾æ¥ é‡è¦ æŠŠé“¾æ¥çš„è¿‡ç¨‹æ¨è¿Ÿåˆ°è¿è¡Œæ—¶è¿›è¡Œï¼Œè¿™å°±æ˜¯åŠ¨æ€é“¾æ¥(Dynamic Linking)çš„åŸºæœ¬æ€æƒ³ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¨‹åºä¸åŠ¨æ€åº“ä¹‹é—´çœŸæ­£çš„é“¾æ¥å·¥ä½œæ˜¯ç”±åŠ¨æ€é“¾æ¥å™¨å®Œæˆçš„ï¼Œè€Œä¸é™æ€é“¾æ¥å™¨ldå®Œæˆã€‚ 2. ç®€å•çš„åŠ¨æ€é“¾æ¥ä¾‹å­ ä½¿ç”¨GCCå°†Lib.cç¼–è¯‘æˆä¸€ä¸ªå…±äº«å¯¹è±¡æ–‡ä»¶: åŠ¨æ€é“¾æ¥è¿‡ç¨‹åŠ¨æ€é“¾æ¥è¿‡ç¨‹ é‡è¦ Lib.cè¢«é“¾æ¥æˆLib.soå…±äº«å¯¹...">
    <link rel="stylesheet" href="/assets/css/styles.f265a2f1.css">
    <link rel="preload" href="/assets/js/runtime~app.4f498ec4.js" as="script"><link rel="preload" href="/assets/css/styles.f265a2f1.css" as="style"><link rel="preload" href="/assets/js/5783.f27e5b5a.js" as="script"><link rel="preload" href="/assets/js/app.9a5769b4.js" as="script">
    <link rel="prefetch" href="/assets/js/cs_linker_chapter05.html.0899ea1a.js" as="script"><link rel="prefetch" href="/assets/js/database_basic_chapter25.html.c069c096.js" as="script"><link rel="prefetch" href="/assets/js/cs_linker_chapter02.html.412cda21.js" as="script"><link rel="prefetch" href="/assets/js/cs_linker_chapter03.html.aaac8c3d.js" as="script"><link rel="prefetch" href="/assets/js/database_basic_chapter13.html.62ec5274.js" as="script"><link rel="prefetch" href="/assets/js/cs_linker_chapter04.html.2c38b86a.js" as="script"><link rel="prefetch" href="/assets/js/database_basic_chapter02.html.48feb39d.js" as="script"><link rel="prefetch" href="/assets/js/database_basic_chapter17.html.2a39d7f9.js" as="script"><link rel="prefetch" href="/assets/js/database_basic_chapter11.html.38d8eaba.js" as="script"><link rel="prefetch" href="/assets/js/database_basic_chapter20.html.d1e650c7.js" as="script"><link rel="prefetch" href="/assets/js/database_basic_chapter05.html.121d129a.js" as="script"><link rel="prefetch" href="/assets/js/photo-swipe.0b129b90.js" as="script"><link rel="prefetch" href="/assets/js/database_basic_chapter14.html.ce256d2b.js" as="script"><link rel="prefetch" href="/assets/js/database_basic_chapter21.html.7052aee8.js" as="script"><link rel="prefetch" href="/assets/js/database_basic_chapter04.html.f9211675.js" as="script"><link rel="prefetch" href="/assets/js/database_basic_chapter03.html.981c7eec.js" as="script"><link rel="prefetch" href="/assets/js/database_basic_chapter12.html.696267e6.js" as="script"><link rel="prefetch" href="/assets/js/database_basic_chapter07.html.75b35736.js" as="script"><link rel="prefetch" href="/assets/js/database_basic_chapter19.html.6dea29a3.js" as="script"><link rel="prefetch" href="/assets/js/database_basic_chapter15.html.6fd779b9.js" as="script"><link rel="prefetch" href="/assets/js/database_basic_chapter10.html.5f6ee4e5.js" as="script"><link rel="prefetch" href="/assets/js/database_basic_chapter01.html.1f25c1e1.js" as="script"><link rel="prefetch" href="/assets/js/database_basic_chapter09.html.6a4df0b1.js" as="script"><link rel="prefetch" href="/assets/js/database_basic_chapter08.html.26f018cb.js" as="script"><link rel="prefetch" href="/assets/js/database_basic_chapter06.html.9ae0eaf4.js" as="script"><link rel="prefetch" href="/assets/js/database_basic_chapter24.html.52cbd137.js" as="script"><link rel="prefetch" href="/assets/js/database_basic_chapter18.html.d2fcdcf2.js" as="script"><link rel="prefetch" href="/assets/js/cs_linker_chapter01.html.b690529c.js" as="script"><link rel="prefetch" href="/assets/js/database_basic_chapter23.html.c910b094.js" as="script"><link rel="prefetch" href="/assets/js/database_basic_chapter22.html.7f510fc8.js" as="script"><link rel="prefetch" href="/assets/js/database_basic_chapter00.html.7246dcbb.js" as="script"><link rel="prefetch" href="/assets/js/7355.25c29d68.js" as="script"><link rel="prefetch" href="/assets/css/1796.styles.30c6aa6a.css" as="style"><link rel="prefetch" href="/assets/js/intro.html.be78d197.js" as="script"><link rel="prefetch" href="/assets/js/database_basic_chapter16.html.f56dff6d.js" as="script"><link rel="prefetch" href="/assets/js/cs_linker_index.html.40d40f53.js" as="script"><link rel="prefetch" href="/assets/js/database_basic_index.html.554a76b1.js" as="script"><link rel="prefetch" href="/assets/js/code_index.html.b8ca672b.js" as="script"><link rel="prefetch" href="/assets/js/index.html.7475c99c.js" as="script"><link rel="prefetch" href="/assets/js/cs_index.html.d1c1ed77.js" as="script"><link rel="prefetch" href="/assets/js/database_index.html.e58268a2.js" as="script"><link rel="prefetch" href="/assets/js/category_é“¾æ¥ã€è£…è½½ä¸åº“_index.html.c053ed43.js" as="script"><link rel="prefetch" href="/assets/js/tag_è®¡ç®—æœºåŸºç¡€_index.html.e91cc16f.js" as="script"><link rel="prefetch" href="/assets/js/tag_æ•°æ®åº“_index.html.382908f7.js" as="script"><link rel="prefetch" href="/assets/js/category_mysql_index.html.aeaebf50.js" as="script"><link rel="prefetch" href="/assets/js/category_cc___index.html.1b1e70e2.js" as="script"><link rel="prefetch" href="/assets/js/tag_cc___index.html.13e4db06.js" as="script"><link rel="prefetch" href="/assets/js/404.html.a3b8510a.js" as="script"><link rel="prefetch" href="/assets/js/timeline_index.html.ecad4aed.js" as="script"><link rel="prefetch" href="/assets/js/category_index.html.cdb956e7.js" as="script"><link rel="prefetch" href="/assets/js/article_index.html.2a785ac3.js" as="script"><link rel="prefetch" href="/assets/js/tag_index.html.7839f727.js" as="script"><link rel="prefetch" href="/assets/js/star_index.html.9a83a39f.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/far-logo.png" alt><!----><span class="vp-site-name hide-in-pad">far</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="åšå®¢ä¸»é¡µ"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><!--]-->åšå®¢ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link route-link-active auto-link" href="/cs/" aria-label="è®¡ç®—æœºåŸºç¡€"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><!--]-->è®¡ç®—æœºåŸºç¡€<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/code/" aria-label="c/c++"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-code" style=""></span><!--]-->c/c++<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/hncat" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">æœç´¢</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/" aria-label="åšå®¢ä¸»é¡µ"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><!--]-->åšå®¢ä¸»é¡µ<!----></a></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header clickable"><span class="font-icon icon fa-fw fa-sm fas fa-code" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/code/" aria-label="c/c++"><!---->c/c++<!----></a><!----></p><ul class="vp-sidebar-links"></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><a class="route-link route-link-active auto-link vp-sidebar-title no-external-link-icon" href="/cs/" aria-label="è®¡ç®—æœºåŸºç¡€"><!---->è®¡ç®—æœºåŸºç¡€<!----></a><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><a class="route-link route-link-active auto-link vp-sidebar-title no-external-link-icon" href="/cs/linker/" aria-label="é“¾æ¥ã€è£…è½½å’Œåº“"><!---->é“¾æ¥ã€è£…è½½å’Œåº“<!----></a><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/cs/linker/chapter01.html" aria-label="ç¬¬ä¸€ç«  ç¼–è¯‘å’Œé“¾æ¥"><!---->ç¬¬ä¸€ç«  ç¼–è¯‘å’Œé“¾æ¥<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/cs/linker/chapter02.html" aria-label="ç¬¬äºŒç«  ç›®æ ‡æ–‡ä»¶"><!---->ç¬¬äºŒç«  ç›®æ ‡æ–‡ä»¶<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/cs/linker/chapter03.html" aria-label="ç¬¬ä¸‰ç«  é™æ€é“¾æ¥"><!---->ç¬¬ä¸‰ç«  é™æ€é“¾æ¥<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/cs/linker/chapter04.html" aria-label="ç¬¬å››ç«  å¯æ‰§è¡Œæ–‡ä»¶çš„è£…è½½"><!---->ç¬¬å››ç«  å¯æ‰§è¡Œæ–‡ä»¶çš„è£…è½½<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/cs/linker/chapter05.html" aria-label="ç¬¬äº”ç«  åŠ¨æ€é“¾æ¥"><!---->ç¬¬äº”ç«  åŠ¨æ€é“¾æ¥<!----></a></li></ul></section></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header clickable"><span class="font-icon icon fa-fw fa-sm fas fa-database" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/database/" aria-label="æ•°æ®åº“"><!---->æ•°æ®åº“<!----></a><!----></p><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-database" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/database/basic/" aria-label="mysqlåŸºç¡€"><!---->mysqlåŸºç¡€<!----></a><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><a class="route-link auto-link vp-sidebar-link" href="/intro.html" aria-label="ä»‹ç»é¡µ"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-circle-info" style=""></span><!--]-->ä»‹ç»é¡µ<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->ç¬¬äº”ç«  åŠ¨æ€é“¾æ¥</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://hncat.github.io" target="_blank" rel="noopener noreferrer">Mr.far</a></span><span property="author" content="Mr.far"></span></span><span class="page-original-info">åŸåˆ›</span><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-07-08T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 45 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT45M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color7 clickable" role="navigation">é“¾æ¥ã€è£…è½½ä¸åº“</span><!--]--><meta property="articleSection" content="é“¾æ¥ã€è£…è½½ä¸åº“"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color7 clickable" role="navigation">è®¡ç®—æœºåŸºç¡€</span><span class="page-tag-item color4 clickable" role="navigation">c/c++</span><!--]--><meta property="keywords" content="è®¡ç®—æœºåŸºç¡€,c/c++"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_1-ä»€ä¹ˆæ˜¯åŠ¨æ€é“¾æ¥">1. ä»€ä¹ˆæ˜¯åŠ¨æ€é“¾æ¥</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_2-ç®€å•çš„åŠ¨æ€é“¾æ¥ä¾‹å­">2. ç®€å•çš„åŠ¨æ€é“¾æ¥ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_3-åœ°å€æ— å…³ä»£ç ">3. åœ°å€æ— å…³ä»£ç </a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-1-å›ºå®šè£…è½½åœ°å€çš„å›°æ‰°">3.1 å›ºå®šè£…è½½åœ°å€çš„å›°æ‰°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-2-è£…è½½æ—¶é‡å®šä½">3.2 è£…è½½æ—¶é‡å®šä½</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-3-åœ°å€æ— å…³ä»£ç ">3.3 åœ°å€æ— å…³ä»£ç </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-4-å…±äº«æ¨¡å—çš„å…¨å±€å˜é‡é—®é¢˜">3.4 å…±äº«æ¨¡å—çš„å…¨å±€å˜é‡é—®é¢˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-5-æ•°æ®æ®µåœ°å€æ— å…³æ€§">3.5 æ•°æ®æ®µåœ°å€æ— å…³æ€§</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-å»¶è¿Ÿç»‘å®š-plt">4. å»¶è¿Ÿç»‘å®š(PLT)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_5-åŠ¨æ€é“¾æ¥ç›¸å…³ç»“æ„">5. åŠ¨æ€é“¾æ¥ç›¸å…³ç»“æ„</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-1-interp-æ®µ">5.1 &quot;.interp&quot;æ®µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-2-dynamic-æ®µ">5.2 &quot;.dynamic&quot;æ®µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-3-åŠ¨æ€ç¬¦å·è¡¨">5.3 åŠ¨æ€ç¬¦å·è¡¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-4-åŠ¨æ€é“¾æ¥é‡å®šä½è¡¨">5.4 åŠ¨æ€é“¾æ¥é‡å®šä½è¡¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-5-åŠ¨æ€é“¾æ¥æ—¶è¿›ç¨‹å †æ ˆåˆå§‹åŒ–ä¿¡æ¯">5.5 åŠ¨æ€é“¾æ¥æ—¶è¿›ç¨‹å †æ ˆåˆå§‹åŒ–ä¿¡æ¯</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_6-åŠ¨æ€é“¾æ¥çš„æ­¥éª¤å’Œå®ç°">6. åŠ¨æ€é“¾æ¥çš„æ­¥éª¤å’Œå®ç°</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-1-åŠ¨æ€é“¾æ¥å™¨è‡ªä¸¾">6.1 åŠ¨æ€é“¾æ¥å™¨è‡ªä¸¾</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-2-è£…è½½å…±äº«å¯¹è±¡">6.2 è£…è½½å…±äº«å¯¹è±¡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-3-é‡å®šä½å’Œåˆå§‹åŒ–">6.3 é‡å®šä½å’Œåˆå§‹åŒ–</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_7-åº“æ‰“æ¡©æœºåˆ¶-hook">7. åº“æ‰“æ¡©æœºåˆ¶(HOOK)</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-1-ç¼–è¯‘æ—¶æ‰“æ¡©">7.1 ç¼–è¯‘æ—¶æ‰“æ¡©</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-2-é“¾æ¥æ—¶æ‰“æ¡©">7.2 é“¾æ¥æ—¶æ‰“æ¡©</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-3-è¿è¡Œæ—¶æ‰“æ¡©">7.3 è¿è¡Œæ—¶æ‰“æ¡©</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h2 id="_1-ä»€ä¹ˆæ˜¯åŠ¨æ€é“¾æ¥" tabindex="-1"><a class="header-anchor" href="#_1-ä»€ä¹ˆæ˜¯åŠ¨æ€é“¾æ¥"><span>1. ä»€ä¹ˆæ˜¯åŠ¨æ€é“¾æ¥</span></a></h2><div class="hint-container important"><p class="hint-container-title">é‡è¦</p><p>æŠŠé“¾æ¥çš„è¿‡ç¨‹æ¨è¿Ÿåˆ°è¿è¡Œæ—¶è¿›è¡Œï¼Œè¿™å°±æ˜¯åŠ¨æ€é“¾æ¥(Dynamic Linking)çš„åŸºæœ¬æ€æƒ³ã€‚<br> éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¨‹åºä¸åŠ¨æ€åº“ä¹‹é—´çœŸæ­£çš„é“¾æ¥å·¥ä½œæ˜¯ç”±åŠ¨æ€é“¾æ¥å™¨å®Œæˆçš„ï¼Œè€Œä¸é™æ€é“¾æ¥å™¨ldå®Œæˆã€‚</p></div><h2 id="_2-ç®€å•çš„åŠ¨æ€é“¾æ¥ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#_2-ç®€å•çš„åŠ¨æ€é“¾æ¥ä¾‹å­"><span>2. ç®€å•çš„åŠ¨æ€é“¾æ¥ä¾‹å­</span></a></h2><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// Program1.c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Lib.h&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  foobar</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// Program2.c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Lib.h&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  foobar</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// Lib.c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &lt;stdio.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> foobar</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  printf</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Printing from Lib.so </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">%d</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, i);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// Lib.h</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#ifndef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> __LIB_H__</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> __LIB_H__</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> foobar</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#endif</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨GCCå°†Lib.cç¼–è¯‘æˆä¸€ä¸ªå…±äº«å¯¹è±¡æ–‡ä»¶:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># shared è¡¨ç¤ºäº§ç”Ÿå…±äº«å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># -fPIC è¡¨ç¤ºç”Ÿæˆä½ç½®æ— å…³ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">gcc</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -fPIC</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -shared</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Lib.so</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Lib.c</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># åˆ†åˆ«ç¼–è¯‘é“¾æ¥Program1å’ŒProgram2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">gcc</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Program1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Program1.c</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ./Lib.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">gcc</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Program2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Program2.c</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ./Lib.so</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/image/linker/chapter05/åŠ¨æ€é“¾æ¥è¿‡ç¨‹.png" alt="åŠ¨æ€é“¾æ¥è¿‡ç¨‹" tabindex="0" loading="lazy"><figcaption>åŠ¨æ€é“¾æ¥è¿‡ç¨‹</figcaption></figure><div class="hint-container important"><p class="hint-container-title">é‡è¦</p><p>Lib.cè¢«é“¾æ¥æˆLib.soå…±äº«å¯¹è±¡æ–‡ä»¶ï¼ŒProgram1.cè¢«ç¼–è¯‘æˆProgram1.oä¹‹åï¼Œé“¾æ¥æˆä¸ºå¯æŒ‡å‘æ–‡ä»¶Program1ã€‚ä½†æ˜¯å’Œé™æ€é“¾æ¥ä¸åŒçš„æ˜¯ï¼ŒProgram1.oè¢«é“¾æ¥æˆå¯æ‰§è¡Œæ–‡ä»¶è¿™ä¸€æ­¥ã€‚åœ¨é™æ€é“¾æ¥ä¸­ï¼Œé“¾æ¥è¿‡ç¨‹ä¼šæŠŠProgram1.oå’ŒLib.oé“¾æ¥åˆ°ä¸€èµ·ï¼Œå¹¶ä¸”è¾“å‡ºå¯æ‰§è¡Œæ–‡ä»¶Program1ã€‚ä½†æ˜¯å¯¹äºåŠ¨æ€é“¾æ¥ï¼ŒLib.oæ²¡æœ‰è¢«é“¾æ¥èµ·æ¥ï¼Œé“¾æ¥çš„è¾“å…¥ç›®æ ‡åªæœ‰Program1.oã€‚ä½†æ˜¯å‘½ä»¤è¡Œä¸­åˆå‘ç°Lib.soä¹Ÿå‚ä¸äº†é“¾æ¥è¿‡ç¨‹ï¼Ÿ<br> å½“ç¨‹åºæ¨¡å—Program1.cè¢«ç¼–è¯‘æˆProgram1.oæ—¶ï¼Œç¼–è¯‘å™¨è¿˜ä¸çŸ¥é“foobar()å‡½æ•°çš„åœ°å€ã€‚å½“é“¾æ¥å™¨å°†Program1.oé“¾æ¥æˆå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œè¿™æ—¶å€™é“¾æ¥å™¨å¿…é¡»ç¡®å®šfoobar()å‡½æ•°çš„æ€§è´¨ã€‚å¦‚æœfoobar()å‡½æ•°æ˜¯ä¸€ä¸ªå®šä¹‰äº<mark>é™æ€ç›®æ ‡æ¨¡å—</mark>ä¸­çš„å‡½æ•°ï¼Œé‚£ä¹ˆé“¾æ¥å™¨å°†ä¼šæŒ‰ç…§é™æ€é“¾æ¥çš„è§„åˆ™ï¼Œ<mark>å°†Program1.oä¸­çš„foobar()åœ°å€å¼•ç”¨é‡å®šä½</mark>ã€‚å¦‚æœfoobar()æ˜¯ä¸€ä¸ªå®šä¹‰åœ¨<mark>åŠ¨æ€å…±äº«å¯¹è±¡</mark>ä¸­çš„å‡½æ•°ï¼Œé‚£ä¹ˆé“¾æ¥å™¨å°±ä¼šå°†è¿™ä¸ªç¬¦å·çš„å¼•ç”¨æ ‡è®°ä¸ºä¸€ä¸ªåŠ¨æ€é“¾æ¥çš„ç¬¦å·ï¼Œ<mark>ä¸å¯¹å…¶è¿›è¡Œåœ°å€é‡å®šä½ï¼ŒæŠŠè¿™ä¸ªè¿‡ç¨‹ä¿ç•™åˆ°è£…è½½æ—¶è¿›è¡Œ</mark>ã€‚<br> å¯¹äºé“¾æ¥å™¨æ˜¯å¦‚ä½•çŸ¥é“foobar()å‡½æ•°çš„å¼•ç”¨æ˜¯ä¸€ä¸ªé™æ€ç¬¦å·è¿˜æ˜¯åŠ¨æ€ç¬¦å·ï¼Ÿè¿™å…¶å®å°±æ˜¯æˆ‘ä»¬è¦ç”¨åˆ°Lib.soçš„åŸå› ã€‚<mark>Lib.soä¿ç•™äº†å®Œæ•´çš„ç¬¦å·ä¿¡æ¯ï¼ˆå› ä¸ºè¿è¡Œæ—¶è¿›è¡ŒåŠ¨æ€é“¾æ¥è¿˜éœ€è¦ä½¿ç”¨ç¬¦å·ä¿¡æ¯ï¼‰</mark>ï¼ŒæŠŠLib.soä¹Ÿä½œä¸ºé“¾æ¥çš„è¾“å…¥æ–‡ä»¶ä¹‹ä¸€ï¼Œ<mark>é“¾æ¥å™¨åœ¨è§£æç¬¦å·æ—¶å°±å¯ä»¥çŸ¥é“ï¼šfoobar()å‡½æ•°æ˜¯ä¸€ä¸ªå®šä¹‰åœ¨Lib.soçš„åŠ¨æ€ç¬¦å·</mark>ã€‚è¿™æ ·é“¾æ¥å™¨å°±å¯ä»¥å †foobar()å‡½æ•°çš„å¼•ç”¨è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œä½¿å®ƒæˆä¸ºä¸€ä¸ªå¯¹åŠ¨æ€ç¬¦å·çš„å¼•ç”¨ã€‚</p></div><p><strong>åŠ¨æ€é“¾æ¥ç¨‹åºè¿è¡Œæ—¶åœ°å€ç©ºé—´åˆ†å¸ƒ</strong></p><div class="hint-container note"><p class="hint-container-title">æ³¨</p><p>å¯¹äºé™æ€é“¾æ¥çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ•´ä¸ªè¿›ç¨‹åªæœ‰å¯æ‰§è¡Œæ–‡ä»¶éœ€è¦è¢«æ˜ å°„ã€‚ä½†æ˜¯å¯¹äºåŠ¨æ€é“¾æ¥æ¥è¯´ï¼Œé™¤äº†å¯æ‰§è¡Œæ–‡ä»¶ä¹‹å¤–ï¼Œè¿˜æœ‰å®ƒæ‰€ä¾èµ–çš„å…±äº«ç›®æ ‡æ–‡ä»¶ã€‚</p></div><p>å¯¹Lib.cçš„foobar()å‡½æ•°è¿›è¡Œä¿®æ”¹</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// Lib.c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &lt;stdio.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &lt;unistd.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> foobar</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  printf</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Printing from Lib.so </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">%d</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, i);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  sleep</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">./Program1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[1] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">10370</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Printing</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Lib.so</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /proc/10370/maps</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">5611c3c79000-5611c3c7a000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:10</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 117001</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                     /home/far/worker/linker/chapter04/SimpleDynamicalLinking/Program1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">5611c3c7a000-5611c3c7b000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r-xp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00001000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:10</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 117001</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                     /home/far/worker/linker/chapter04/SimpleDynamicalLinking/Program1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">5611c3c7b000-5611c3c7c000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00002000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:10</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 117001</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                     /home/far/worker/linker/chapter04/SimpleDynamicalLinking/Program1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">5611c3c7c000-5611c3c7d000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00002000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:10</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 117001</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                     /home/far/worker/linker/chapter04/SimpleDynamicalLinking/Program1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">5611c3c7d000-5611c3c7e000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rw-p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00003000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:10</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 117001</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                     /home/far/worker/linker/chapter04/SimpleDynamicalLinking/Program1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">5611c5450000-5611c5471000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rw-p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 00:00</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                          [heap]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7f066eb09000-7f066eb0c000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rw-p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 00:00</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7f066eb0c000-7f066eb34000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:10</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 49449</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                      /usr/lib/x86_64-linux-gnu/libc.so.6</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7f066eb34000-7f066ecbc000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r-xp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00028000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:10</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 49449</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                      /usr/lib/x86_64-linux-gnu/libc.so.6</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7f066ecbc000-7f066ed0b000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 001b0000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:10</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 49449</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                      /usr/lib/x86_64-linux-gnu/libc.so.6</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7f066ed0b000-7f066ed0f000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 001fe000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:10</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 49449</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                      /usr/lib/x86_64-linux-gnu/libc.so.6</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7f066ed0f000-7f066ed11000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rw-p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00202000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:10</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 49449</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                      /usr/lib/x86_64-linux-gnu/libc.so.6</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7f066ed11000-7f066ed1e000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rw-p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 00:00</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7f066ed25000-7f066ed26000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:10</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 116994</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                     /home/far/worker/linker/chapter04/SimpleDynamicalLinking/Lib.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7f066ed26000-7f066ed27000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r-xp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00001000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:10</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 116994</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                     /home/far/worker/linker/chapter04/SimpleDynamicalLinking/Lib.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7f066ed27000-7f066ed28000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00002000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:10</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 116994</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                     /home/far/worker/linker/chapter04/SimpleDynamicalLinking/Lib.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7f066ed28000-7f066ed29000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00002000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:10</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 116994</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                     /home/far/worker/linker/chapter04/SimpleDynamicalLinking/Lib.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7f066ed29000-7f066ed2a000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rw-p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00003000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:10</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 116994</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                     /home/far/worker/linker/chapter04/SimpleDynamicalLinking/Lib.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7f066ed2a000-7f066ed2c000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rw-p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 00:00</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7f066ed2c000-7f066ed2d000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:10</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 49446</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                      /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7f066ed2d000-7f066ed58000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r-xp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00001000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:10</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 49446</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                      /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7f066ed58000-7f066ed62000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 0002c000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:10</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 49446</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                      /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7f066ed62000-7f066ed64000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00036000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:10</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 49446</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                      /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7f066ed64000-7f066ed66000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rw-p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00038000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:10</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 49446</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                      /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ffe6cfa3000-7ffe6cfc4000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rw-p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 00:00</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                          [stack]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ffe6cfe6000-7ffe6cfea000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 00:00</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                          [vvar]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ffe6cfea000-7ffe6cfeb000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r-xp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 00:00</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                          [vdso]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">kill</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 10370</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[1]  + 10370 terminated  ./Program1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è§‚å¯Ÿåˆ°æ•´ä¸ªè™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ï¼Œå¤šå‡ºäº†å‡ ä¸ªæ–‡ä»¶çš„æ˜ å°„ã€‚Lib.soä¸Program1ä¸€æ ·ï¼Œå®ƒä»¬éƒ½æ˜¯è¢«æ“ä½œç³»ç»Ÿç”¨åŒæ ·çš„æ–¹æ³•æ˜ å°„è‡³è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚Program1é™¤äº†ä½¿ç”¨Lib.soå¤–ï¼Œè¿˜æ˜¯ç”¨åˆ°äº†åŠ¨æ€é“¾æ¥å½¢å¼çš„<mark>Cè¯­è¨€è¿è¡Œæ—¶åº“(/usr/lib/x86_64-linux-gnu/libc.so.6)</mark>ã€‚è¿˜æœ‰Linuxä¸‹çš„<mark>åŠ¨æ€é“¾æ¥å™¨(/usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2)</mark>ã€‚åŠ¨æ€é“¾æ¥å™¨å’Œæ™®é€šå…±äº«å¯¹è±¡ä¸€æ ·è¢«æ˜ å°„åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œåœ¨ç³»ç»Ÿå¼€å§‹è¿è¡ŒProgram1ä¹‹å‰ï¼Œé¦–å…ˆå°†æ§åˆ¶æƒäº¤ç»™åŠ¨æ€é“¾æ¥å™¨ï¼Œç”±å®ƒå®Œæˆæ‰€æœ‰çš„åŠ¨æ€é“¾æ¥å·¥ä½œåå†æŠŠæ§åˆ¶æƒäº¤ç»™Program1ï¼Œæœ€åå¼€å§‹æ‰§è¡Œã€‚</p><p>é€šè¿‡readelfæŸ¥çœ‹Lib.soçš„è£…è½½å±æ€§:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">readelf</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -l</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Lib.so</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Elf</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> file</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> type</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DYN</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (Shared </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">object</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Entry</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> point</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">There</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> are</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> program</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> headers,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> starting</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> at</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> offset</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 64</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Program</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Headers:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  Type</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">           Offset</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">             VirtAddr</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">           PhysAddr</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">                 FileSiz</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">            MemSiz</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">              Flags</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  Align</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  LOAD</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">           0x0000000000000000</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x0000000000000000</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x0000000000000000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">                 0x0000000000000560</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x0000000000000560</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  R</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">      0x1000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  LOAD</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">           0x0000000000001000</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x0000000000001000</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x0000000000001000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">                 0x000000000000017d</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x000000000000017d</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  R</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> E</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    0x1000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  LOAD</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">           0x0000000000002000</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x0000000000002000</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x0000000000002000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">                 0x00000000000000dc</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x00000000000000dc</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  R</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">      0x1000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  LOAD</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">           0x0000000000002df8</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x0000000000003df8</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x0000000000003df8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">                 0x0000000000000220</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x0000000000000228</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  RW</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     0x1000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  DYNAMIC</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">        0x0000000000002e08</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x0000000000003e08</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x0000000000003e08</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">                 0x00000000000001c0</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x00000000000001c0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  RW</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     0x8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  NOTE</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">           0x00000000000002a8</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x00000000000002a8</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x00000000000002a8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">                 0x0000000000000020</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x0000000000000020</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  R</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">      0x8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  NOTE</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">           0x00000000000002c8</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x00000000000002c8</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x00000000000002c8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">                 0x0000000000000024</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x0000000000000024</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  R</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">      0x4</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  GNU_PROPERTY</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   0x00000000000002a8</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x00000000000002a8</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x00000000000002a8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">                 0x0000000000000020</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x0000000000000020</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  R</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">      0x8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  GNU_EH_FRAME</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   0x000000000000201c</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x000000000000201c</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x000000000000201c</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">                 0x000000000000002c</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x000000000000002c</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  R</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">      0x4</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  GNU_STACK</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">      0x0000000000000000</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x0000000000000000</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x0000000000000000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">                 0x0000000000000000</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x0000000000000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  RW</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     0x10</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  GNU_RELRO</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">      0x0000000000002df8</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x0000000000003df8</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x0000000000003df8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">                 0x0000000000000208</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x0000000000000208</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  R</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">      0x1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Section</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Segment</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mapping:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  Segment</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Sections...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">   00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">     .note.gnu.property</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .note.gnu.build-id</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .gnu.hash</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .dynsym</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .dynstr</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .gnu.version</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .gnu.version_r</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .rela.dyn</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .rela.plt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">   01</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">     .init</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .plt</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .plt.got</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .plt.sec</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .text</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .fini</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">   02</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">     .rodata</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .eh_frame_hdr</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .eh_frame</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">   03</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">     .init_array</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .fini_array</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .dynamic</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .got</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .got.plt</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .data</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .bss</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">   04</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">     .dynamic</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">   05</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">     .note.gnu.property</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">   06</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">     .note.gnu.build-id</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">   07</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">     .note.gnu.property</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">   08</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">     .eh_frame_hdr</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">   09</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">   10</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">     .init_array</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .fini_array</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .dynamic</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .got</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container note"><p class="hint-container-title">æ³¨</p><p>é™¤äº†æ–‡ä»¶ç±»å‹ä¸æ™®é€šç¨‹åºä¸åŒä¹‹å¤–ï¼Œå…¶å®ƒå‡ ä¹ä¸æ™®é€šç¨‹åºä¸€æ ·ã€‚è¿˜æœ‰ä¸€ç‚¹ä¸åŒçš„æ˜¯ï¼ŒåŠ¨æ€é“¾æ¥æ¨¡å—çš„è£…è½½åœ°å€æ˜¯ä»åœ°å€0x0000000000000000å¼€å§‹çš„ã€‚æˆ‘ä»¬çŸ¥é“è¿™ä¸ªåœ°å€æ˜¯æ— æ•ˆåœ°å€ï¼Œå¹¶ä¸”ä»ä¸Šé¢çš„è¿›ç¨‹è™šæ‹Ÿç©ºé—´åˆ†å¸ƒçœ‹åˆ°ï¼ŒLib.soçš„æœ€ç»ˆè£…è½½åœ°å€å¹¶ä¸æ˜¯0x0000000000000000ï¼Œè€Œæ˜¯0x7f066ed25000ã€‚ä»è¿™ä¸€ç‚¹å¯ä»¥æ¨æ–­ï¼Œ<mark>å…±äº«å¯¹è±¡çš„æœ€ç»ˆè£…è½½åœ°å€åœ¨ç¼–è¯‘æ—¶æ˜¯ä¸ç¡®å®šçš„</mark>ï¼Œè€Œæ˜¯åœ¨è£…è½½æ—¶ï¼Œè£…è½½å™¨æ ¹æ®å½“å‰åœ°å€ç©ºé—´çš„ç©ºé—²æƒ…å†µï¼ŒåŠ¨æ€çš„åˆ†é…ä¸€å—è¶³å¤Ÿå¤§å°çš„åœ°å€ç©ºé—´ç»™ç›¸åº”çš„å…±äº«å¯¹è±¡ã€‚</p></div><h2 id="_3-åœ°å€æ— å…³ä»£ç " tabindex="-1"><a class="header-anchor" href="#_3-åœ°å€æ— å…³ä»£ç "><span>3. åœ°å€æ— å…³ä»£ç </span></a></h2><h3 id="_3-1-å›ºå®šè£…è½½åœ°å€çš„å›°æ‰°" tabindex="-1"><a class="header-anchor" href="#_3-1-å›ºå®šè£…è½½åœ°å€çš„å›°æ‰°"><span>3.1 å›ºå®šè£…è½½åœ°å€çš„å›°æ‰°</span></a></h3><div class="hint-container note"><p class="hint-container-title">æ³¨</p><p>ä¸ºäº†å®ç°åŠ¨æ€é“¾æ¥ï¼Œæˆ‘ä»¬é¦–å…ˆä¼šé‡åˆ°çš„é—®é¢˜æ˜¯å…±äº«å¯¹è±¡åœ°å€å†²çªé—®é¢˜ã€‚åœ¨åŠ¨æ€é“¾æ¥çš„æƒ…å†µä¸‹ï¼Œå¦‚æœä¸åŒçš„æ¨¡å—ç›®æ ‡è£…è½½åœ°å€éƒ½ä¸€æ ·æ˜¯ä¸è¡Œçš„ã€‚è€Œå¯¹äºå•ä¸ªç¨‹åºæ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹å·¥æŒ‡å®šå„ä¸ªæ¨¡å—çš„åœ°å€ï¼Œæ¯”å¦‚0x1000åˆ°0x2000åˆ†é…ç»™æ¨¡å—Aï¼ŒæŠŠåœ°å€0x2000åˆ°0x3000åˆ†é…ç»™æ¨¡å—Bã€‚ä½†æ˜¯ï¼Œå¦‚æœæŸä¸ªæ¨¡å—è¢«å¤šä¸ªç¨‹åºä½¿ç”¨ï¼Œæˆ–è€…å¤šä¸ªæ¨¡å—è¢«å¤šä¸ªç¨‹åºä½¿ç”¨å‘¢ï¼Ÿè¿™å°†ä¼šä½¿å¾—ç®¡ç†è¿™äº›æ¨¡å—çš„åœ°å€å°†æ˜¯ä¸€ä»¶æ— æ¯”ç¹ççš„äº‹æƒ…ã€‚<br> ä¾‹å¦‚ç¨‹åºprogram1ä½¿ç”¨äº†æ¨¡å—Bï¼Œä½†æ˜¯æ²¡æœ‰ä½¿ç”¨æ¨¡å—Aï¼Œæ‰€ä»¥ä»–è®¤ä¸ºåœ°å€0x1000åˆ°0x2000çš„åœ°å€æ˜¯ç©ºé—²çš„ï¼Œä½™æ•°åˆ†é…ç»™äº†å¦ä¸€ä¸ªæ¨¡å—Cã€‚è¿™æ ·Cå’ŒåŸå…ˆçš„æ¨¡å—Açš„ç›®æ ‡åœ°å€å°±å†²çªäº†ï¼Œä»»ä½•äººä»¥åå°†ä¸èƒ½åœ¨åŒä¸€ä¸ªç¨‹åºé‡Œé¢ä½¿ç”¨æ¨¡å—Aå’ŒCã€‚è¿™ç§åšæ³•å°±å«åš<mark>é™æ€å…±äº«åº“(Static Shared Library)</mark>ã€‚ç›¸æ¯”äºé™æ€é“¾æ¥ï¼Œé™æ€å…±äº«åº“çš„åšæ³•å°±æ˜¯å°†ç¨‹åºçš„å„ä¸ªæ¨¡å—ç»Ÿä¸€äº¤ç»™æ“ä½œç³»ç»Ÿç®¡ç†ï¼Œæ“ä½œç³»ç»Ÿåœ¨æŸä¸ªç‰¹å®šçš„åœ°å€åˆ’åˆ†å‡ºä¸€äº›åœ°å€å—ï¼Œä¸ºé‚£äº›å·²çŸ¥çš„æ¨¡å—é¢„ç•™è¶³å¤Ÿçš„ç©ºé—´ã€‚<br> é™æ€å…±äº«åº“çš„ç›®æ ‡åœ°å€å¯¼è‡´äº†å¾ˆå¤šé—®é¢˜ï¼Œé™¤äº†åœ°å€å†²çªå¤–ï¼Œé™æ€å…±äº«åº“çš„å‡çº§ä¹Ÿæ˜¯é—®é¢˜ï¼Œå› ä¸ºå‡çº§åçš„å…±äº«åº“å¿…é¡»ä¿æŒå…±äº«åº“ä¸­å…¨å±€å‡½æ•°å’Œå˜é‡åœ°å€çš„ä¸å˜ï¼Œå¦‚æœåº”ç”¨ç¨‹åºåœ¨é“¾æ¥æ—¶å·²ç»ç»‘å®šäº†è¿™äº›åœ°å€ï¼Œä¸€æ—¦å˜æ›´ï¼Œå°±å¿…é¡»é‡æ–°é“¾æ¥åº”ç”¨ç¨‹åºï¼Œå¦åˆ™å°±ä¼šå¼•èµ·åº”ç”¨ç¨‹åºå´©æºƒã€‚å³ä½¿å‡çº§é™æ€å…±äº«åº“åä¿æŒåŸæœ‰çš„å‡½æ•°å’Œå˜é‡åœ°å€ä¸å˜ï¼Œåªæ˜¯å¢åŠ äº†ä¸€äº›å…¨å±€å‡½æ•°æˆ–å˜é‡ï¼Œä¹Ÿä¼šå—åˆ°é™åˆ¶ï¼Œå› ä¸ºé™æ€å…±äº«åº“è¢«åˆ†é…åˆ°çš„è™šæ‹Ÿåœ°å€ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œä¸èƒ½å¢é•¿å¤ªå¤šï¼Œå¦åˆ™å°±ä¼šè¶…å‡ºè¢«åˆ†é…çš„ç©ºé—´ã€‚<br> ä¸ºäº†è§£å†³è¿™ä¸ªæ¨¡å—è£…è½½åœ°å€å›ºå®šçš„é—®é¢˜ï¼Œæˆ‘ä»¬è®¾æƒ³æ˜¯å¦å¯ä»¥è®©å…±äº«å¯¹è±¡åœ¨<mark>ä»»æ„åœ°å€</mark>åŠ è½½ï¼Ÿæ—¢<mark>å…±äº«å¯¹è±¡åœ¨ç¼–è¯‘æ—¶ä¸èƒ½å‡è®¾è‡ªå·±åœ¨è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„ä½ç½®</mark>ã€‚å¯¹äºå¯æ‰§è¡Œæ–‡ä»¶åŸºæœ¬å¯ä»¥ç¡®å®šè‡ªå·±åœ¨è¿›ç¨‹è™šæ‹Ÿç©ºé—´ä¸­çš„èµ·å§‹ä½ç½®ï¼Œå› ä¸ºå¯æ‰§è¡Œæ–‡ä»¶å¾€å¾€æ˜¯ç¬¬ä¸€ä¸ªè¢«åŠ è½½çš„æ–‡ä»¶ã€‚</p></div><h3 id="_3-2-è£…è½½æ—¶é‡å®šä½" tabindex="-1"><a class="header-anchor" href="#_3-2-è£…è½½æ—¶é‡å®šä½"><span>3.2 è£…è½½æ—¶é‡å®šä½</span></a></h3><div class="hint-container important"><p class="hint-container-title">é‡è¦</p><p>åœ¨é“¾æ¥æ—¶ï¼Œå¯¹æ‰€æœ‰ç»å¯¹åœ°å€çš„å¼•ç”¨ä¸åšé‡å®šä½ï¼Œè€ŒæŠŠè¿™ä¸€æ­¥æ¨è¿Ÿåˆ°è£…è½½æ—¶å®Œæˆã€‚ä¸€æ—¦æ¨¡å—è£…è½½åœ°å€ç¡®å®šï¼Œæ—¢ç›®æ ‡åœ°å€ç¡®å®šï¼Œé‚£ä¹ˆç³»ç»Ÿå°±å¯¹ç¨‹åºä¸­æ‰€æœ‰çš„ç»å¯¹åœ°å€å¼•ç”¨è¿›è¡Œé‡å®šä½ã€‚<br> é™æ€é“¾æ¥æ—¶çš„é‡å®šä½è¢«ç§°ä¸º<mark>é“¾æ¥æ—¶é‡å®šä½(Link Time Relocation)</mark>ï¼Œè€Œç°åœ¨è¿™ç§æƒ…å†µé€šå¸¸è¢«ç§°ä¸º<mark>è£…è½½æ—¶é‡å®šä½(Load Time Relocation)</mark>ã€‚<br> è£…è½½æ—¶é‡å®šä½çš„é—®é¢˜ï¼šåŠ¨æ€é“¾æ¥æ¨¡å—è¢«è£…è½½è‡³è™šæ‹Ÿç©ºé—´åï¼ŒæŒ‡ä»¤éƒ¨åˆ†æ˜¯åœ¨å¤šä¸ªè¿›ç¨‹ä¹‹é—´å…±äº«çš„ï¼Œç”±äºè£…è½½æ—¶é‡å®šä½çš„æ–¹æ³•éœ€è¦ä¿®æ”¹æŒ‡ä»¤ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•åšåˆ°åŒä¸€ä»½æŒ‡ä»¤è¢«å¤šä¸ªè¿›ç¨‹å…±äº«ï¼Œ<mark>å› ä¸ºæŒ‡ä»¤éƒ¨åˆ†å¯¹äºæ¯ä¸ªè¿›ç¨‹æ¥è¯´å¯èƒ½ä¼šè¢«æ˜ å°„åˆ°æ¯ä¸ªè¿›ç¨‹çš„ä¸åŒè™šæ‹Ÿç©ºé—´ï¼Œä»è€Œå¯¼è‡´è¿™äº›åœ°å€å¯¹æ¯ä¸ªè¿›ç¨‹æ¥è¯´æ˜¯ä¸åŒçš„</mark>ã€‚è€Œå¯¹äºå¯ä¿®æ”¹æ•°æ®éƒ¨åˆ†æ¥è¯´æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸åŒçš„å‰¯æœ¬ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨è£…è½½æ—¶é‡å®šä½çš„æ–¹æ³•æ¥å¤„ç†ã€‚<br> Linuxçš„GCCç¼–è¯‘å™¨æ”¯æŒè¿™ç§è£…è½½æ—¶é‡å®šä½çš„æ–¹æ³•ï¼Œåœ¨ç¼–è¯‘æ—¶å¯ä»¥åªä½¿ç”¨-sharedé€‰é¡¹è€Œä¸ä½¿ç”¨-fPICé€‰é¡¹ã€‚</p></div><h3 id="_3-3-åœ°å€æ— å…³ä»£ç " tabindex="-1"><a class="header-anchor" href="#_3-3-åœ°å€æ— å…³ä»£ç "><span>3.3 åœ°å€æ— å…³ä»£ç </span></a></h3><div class="hint-container note"><p class="hint-container-title">æ³¨</p><p>è£…è½½æ—¶é‡å®šä½æ˜¯è§£å†³åŠ¨æ€æ¨¡å—ä¸­æ²¡æœ‰ç»å¯¹åœ°å€åº”ç”¨çš„åŠæ³•ä¹‹ä¸€ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ç¼ºç‚¹æ˜¯æŒ‡ä»¤éƒ¨åˆ†æ— æ³•åœ¨å¤šä¸ªè¿›ç¨‹ä¹‹é—´å…±äº«ï¼Œè¿™æ ·å°±å¤±å»äº†åŠ¨æ€é“¾æ¥èŠ‚çœå†…å­˜çš„ä¸€å¤§ä¼˜åŠ¿ã€‚<br> ç°åœ¨æˆ‘ä»¬å¸Œæœ›ç¨‹åºæ¨¡å—ä¸­å…±äº«çš„æŒ‡ä»¤éƒ¨åˆ†åœ¨è£…è½½æ—¶ä¸éœ€è¦å› ä¸ºè£…è½½åœ°å€çš„æ”¹å˜è€Œæ”¹å˜ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å°†æŒ‡ä»¤ä¸­é‚£äº›éœ€è¦è¢«ä¿®æ”¹çš„éƒ¨åˆ†è¿›è¡Œå‰¥ç¦»ï¼Œå’Œæ•°æ®éƒ¨åˆ†æ”¾åœ¨ä¸€èµ·ï¼Œè¿™æ ·æŒ‡ä»¤éƒ¨åˆ†å°±å¯ä»¥ä¿æŒä¸å˜ï¼Œè€Œæ•°æ®éƒ¨åˆ†å¯ä»¥åœ¨æ¯ä¸ªè¿›ç¨‹ä¸­æ‹¥æœ‰ä¸€ä¸ªå‰¯æœ¬ã€‚è¿™ç§æ–¹æ¡ˆå°±æ˜¯<mark>åœ°å€æ— å…³ä»£ç (PIC, Position-Independent Code)</mark>ã€‚</p></div><p>å°†å…±äº«å¯¹è±¡ä¸­çš„åœ°å€å¼•ç”¨æŒ‰ç…§æ˜¯å¦è·¨æ¨¡å—åˆ†ä¸º: <mark>æ¨¡å—å†…éƒ¨å¼•ç”¨å’Œæ¨¡å—å¤–éƒ¨å¼•ç”¨</mark>ã€‚</p><p>æŒ‰ç…§ä¸åŒçš„å¼•ç”¨æ–¹å¼åˆåˆ†ä¸ºï¼š<mark>æŒ‡ä»¤å¼•ç”¨å’Œæ•°æ®è®¿é—®</mark>ã€‚</p><p>å› æ­¤æœ‰å¦‚ä¸‹æ–¹å¼:</p><ul><li>æ¨¡å—å†…éƒ¨çš„å‡½æ•°è°ƒç”¨ã€è·³è½¬ç­‰ã€‚</li><li>æ¨¡å—å†…éƒ¨çš„æ•°æ®è®¿é—®ï¼Œæ¯”å¦‚æ¨¡å—ä¸­å®šä¹‰çš„å…¨å±€å˜é‡ã€é™æ€å˜é‡ã€‚</li><li>æ¨¡å—å¤–éƒ¨çš„å‡½æ•°è°ƒç”¨ã€è·³è½¬ç­‰ã€‚</li><li>æ¨¡å—å¤–éƒ¨çš„æ•°æ®è®¿é—®ï¼Œæ¯”å¦‚å…¶å®ƒæ¨¡å—ä¸­å®šä¹‰çš„å…¨å±€å˜é‡ã€‚</li></ul><ol><li>barä¸ºéé™æ€å‡½æ•°æ—¶</li></ol><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// pic.c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> a;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">extern</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> b;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">extern</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ext</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> bar</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  a </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> // æ¨¡å—å†…éƒ¨æ•°æ®è®¿é—®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  b </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ¨¡å—å¤–éƒ¨æ•°æ®è®¿é—®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> foo</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  bar</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> // æ¨¡å—å†…éƒ¨å‡½æ•°è°ƒç”¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  ext</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> // æ¨¡å—å¤–éƒ¨å‡½æ•°è°ƒç”¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">gcc</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -shared</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -fPIC</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pic.c</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> libpic.so</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-asm line-numbers-mode" data-highlighter="shiki" data-ext="asm" data-title="asm" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">Disassembly of section </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">plt.sec:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">0000000000001060</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &lt;ext@plt&gt;:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1060</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       f3 0f 1e fa             </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">endbr64</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1064</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       ff </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">25</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 96</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> 2f </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">       jmp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    *</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0x2f96</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)       </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> # 4000 &lt;ext&gt;</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">    106a:</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">       66</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> 0f 1f </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">44</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">       nopw   </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0x0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rax</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rax</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">0000000000001070</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &lt;bar@plt&gt;:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1070</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       f3 0f 1e fa             </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">endbr64</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1074</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       ff </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">25</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> 8e 2f </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">       jmp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    *</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0x2f8e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)       </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> # 4008 &lt;bar+0x2ecf&gt;</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">    107a:</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">       66</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> 0f 1f </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">44</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">       nopw   </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0x0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rax</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rax</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">0000000000001139</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &lt;bar&gt;:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1139</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       f3 0f 1e fa             </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">endbr64</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    113d</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       c7 </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">05</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> d5 2e </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 01</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    movl   </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$0x1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0x2ed5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)       </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> # 401c &lt;a&gt;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1144</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1147</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">48</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> 8b </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">05</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 72</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> 2e </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    mov</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    0x2e72</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rax</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        # 3fc0 &lt;b&gt;</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">    114e:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">       c7 </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 02</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">       movl   </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$0x2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,(%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rax</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1154</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       c3                      </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">ret</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">0000000000001155</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &lt;foo&gt;:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1155</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       f3 0f 1e fa             </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">endbr64</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1159</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">48</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 83</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ec </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">08</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">             sub</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    $0x8</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rsp</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    115d</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       b8 </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">          mov</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    $0x0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">eax</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1162</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       e8 </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">09</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ff ff ff          </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">call</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">   1070</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &lt;bar@plt&gt;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1167</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       b8 </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">          mov</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    $0x0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">eax</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">    116c:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">       e8 ef fe ff ff          </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">call</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">   1060</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &lt;ext@plt&gt;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1171</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">48</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 83</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> c4 </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">08</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">             add</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    $0x8</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rsp</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1175</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       c3                      </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">ret</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>baré™æ€å‡½æ•°æ—¶</li></ol><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> a;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">extern</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> b;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">extern</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ext</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> bar</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  a </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> // æ¨¡å—å†…éƒ¨æ•°æ®è®¿é—®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  b </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ¨¡å—å¤–éƒ¨æ•°æ®è®¿é—®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> foo</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  bar</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> // æ¨¡å—å†…éƒ¨å‡½æ•°è°ƒç”¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  ext</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> // æ¨¡å—å¤–éƒ¨å‡½æ•°è°ƒç”¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">gcc</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -shared</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -fPIC</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pic.c</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> libpic.so</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-asm line-numbers-mode" data-highlighter="shiki" data-ext="asm" data-title="asm" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">0000000000001119</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &lt;bar&gt;:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1119</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       c7 </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">05</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> f1 2e </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 01</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    movl   </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$0x1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0x2ef1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)       </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> # 4014 &lt;a&gt;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1120</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1123</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">48</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> 8b </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">05</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 96</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> 2e </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    mov</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    0x2e96</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rax</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        # 3fc0 &lt;b&gt;</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">    112a:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">       c7 </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 02</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">       movl   </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$0x2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,(%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rax</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1130</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       c3                      </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">ret</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">0000000000001131</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &lt;foo&gt;:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1131</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       f3 0f 1e fa             </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">endbr64</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1135</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">48</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 83</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ec </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">08</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">             sub</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    $0x8</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rsp</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1139</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       b8 </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">          mov</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    $0x0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">eax</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">    113e:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">       e8 d6 ff ff ff          </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">call</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">   1119</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &lt;bar&gt;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1143</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       b8 </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">          mov</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    $0x0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">eax</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1148</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       e8 </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">03</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ff ff ff          </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">call</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">   1050</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &lt;ext@plt&gt;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    114d</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">48</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 83</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> c4 </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">08</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">             add</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    $0x8</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rsp</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1151</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       c3                      </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">ret</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç±»å‹ä¸€ æ¨¡å—å†…éƒ¨è°ƒç”¨æˆ–è·³è½¬</strong></p><div class="hint-container note"><p class="hint-container-title">æ³¨</p><p>æ ¹æ®objdumpåæ±‡ç¼–åå¾—åˆ°çš„ç»“æœå’Œä¹¦ä¸­åˆ—å‡ºçš„ä¸å¤ªä¸€æ ·ã€‚å®é™…æ±‡ç¼–å¾—åˆ°çš„ç»“æœæ˜¯ä½¿ç”¨äº†<mark>å…±äº«å¯¹è±¡å…¨å±€ç¬¦å·ä»‹å…¥(Global Symbol Interposition)</mark>ã€‚åœ¨åŠ¨æ€é“¾æ¥çš„å®ç°ä¸­ä¼šæåˆ°ã€‚<br> ä½†æ˜¯å½“ä½ è®²barå‡½æ•°ä¿®æ”¹ä¸ºé™æ€æˆå‘˜å‡½æ•°æ—¶å°±æ˜¯ä¹¦ä¸­æƒ³è¦çš„ç»“æœ(æˆ–è®¸æ˜¯ä¹¦ä¸­çš„çº°æ¼å§ï¼Œä½œä¸ºè¡¥å……æˆ‘åœ¨è¿™é‡Œç»™å‡ºäº†ä¹¦ä¸­æƒ³è¦çš„æ•ˆæœ)ã€‚</p></div><p>è¿™ç§æƒ…å†µæ˜¯æœ€ç®€å•çš„ï¼Œå› ä¸ºè¢«è°ƒç”¨çš„å‡½æ•°ä¸è°ƒç”¨è€…éƒ½åœ¨åŒä¸€ä¸ªæ¨¡å—ï¼Œæ‰€ä»¥å®ƒä»¬ä¹‹é—´çš„ç›¸å¯¹ä½ç½®æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¼šæ¯”è¾ƒç®€å•ã€‚å¯¹äºç°ä»£ç³»ç»Ÿæ¥è¯´ï¼Œæ¨¡å—å†…éƒ¨çš„è·³è½¬ã€å‡½æ•°è°ƒç”¨éƒ½å¯ä»¥æ˜¯ç›¸å¯¹åœ°å€è°ƒç”¨ï¼Œæˆ–è€…æ˜¯åŸºäºå¯„å­˜å™¨çš„ç›¸å¯¹è°ƒç”¨ï¼Œæ‰€ä»¥å¯¹äºè¿™ç§æŒ‡ä»¤æ˜¯ä¸éœ€è¦é‡å®šä½çš„ã€‚</p><p><strong>ç±»å‹äºŒ æ¨¡å—å†…éƒ¨æ•°æ®è®¿é—®</strong><br> ä»»ä½•ä¸€æ¡æŒ‡ä»¤ä¸å®ƒéœ€è¦è®¿é—®çš„æ¨¡å—å†…éƒ¨æ•°æ®ä¹‹é—´çš„ç›¸å¯¹ä½ç½®æ˜¯å›ºå®šçš„ï¼Œé‚£ä¹ˆåªéœ€è¦ç›¸å¯¹äºå½“å‰æŒ‡ä»¤(PCå€¼)åŠ ä¸Šå›ºå®šçš„åç§»é‡å°±å¯ä»¥è®¿é—®æ¨¡å—å†…éƒ¨æ•°æ®äº†ã€‚ä¾‹å¦‚å‡½æ•°barä¸­çš„ä¸€æ®µåæ±‡ç¼–ä»£ç :</p><div class="language-asm line-numbers-mode" data-highlighter="shiki" data-ext="asm" data-title="asm" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># %ripæ—¢æ˜¯å¯¹åº”çš„PCå€¼(å½“å‰æ‰§è¡Œçš„ä¸‹ä¸€æ¡æŒ‡ä»¤)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">113d</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       c7 </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">05</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> d5 2e </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 01</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    movl   </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$0x1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0x2ed5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)       </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> # 401c &lt;a&gt;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">1144</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> # aå†…å­˜åœ°å€è¿›è¡Œäº†ä¸€æ¬¡å†…å­˜å¯¹é½ï¼Œæ‰€ä»¥éœ€è¦è¡¥0æ‰€ä»¥%ripå®é™…å€¼ä¸º0x1147</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">1147</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">48</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> 8b </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">05</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 72</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> 2e </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    mov</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    0x2e72</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rax</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        # 3fc0 &lt;b&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‡è®¾è¯¥æ¨¡å—ç»è¿‡åŠ è½½åä½äºè™šæ‹Ÿå†…å­˜çš„0x10000000å¤„ï¼Œé‚£å˜é‡aæ‰€åœ¨çš„è™šæ‹Ÿå†…å­˜åœ°å€ä¸º: 0x2ed5 + 0x1147 + 0x10000000 = 0x1000401cã€‚<br> è€Œé€šè¿‡æŸ¥çœ‹ç¬¦å·è¡¨ä¿¡æ¯å¯ä»¥å¾—åˆ°å˜é‡aæ‰€åœ¨elfæ–‡ä»¶ä¸­çš„ä½ç½®:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">readelf</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> libpic.so</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># åªæ˜¾ç¤ºäº†éƒ¨åˆ†æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ymbol</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> table</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;.symtab&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> contains</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 29</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> entries:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">   Num:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    Value</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          Size</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Type</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    Bind</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   Vis</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">      Ndx</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Name</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">    ...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    10:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 000000000000401c</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     4</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> OBJECT</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  LOCAL</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  DEFAULT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   22</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> a</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">    ...</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç±»å‹ä¸‰ æ¨¡å—é—´æ•°æ®è®¿é—®</strong><br> è¦ä½¿å¾—ä»£ç åœ°å€æ— å…³ï¼ŒåŸºæœ¬çš„æ€æƒ³æ˜¯æŠŠå’Œåœ°å€ç›¸å…³çš„éƒ¨åˆ†æ”¾åˆ°æ•°æ®æ®µé‡Œé¢ï¼Œå¾ˆæ˜æ˜¾ï¼Œè¿™äº›å…¶å®ƒæ¨¡å—çš„å…¨å±€å˜é‡çš„åœ°å€æ˜¯å’Œæ¨¡å—è£…è½½åœ°å€ç›¸å…³çš„ã€‚elfçš„åšæ³•æ˜¯åœ¨æ•°æ®æ®µé‡Œé¢åˆ›å»ºä¸€ä¸ª<mark>æŒ‡å‘è¿™äº›å˜é‡çš„æŒ‡é’ˆæ•°ç»„</mark>ï¼Œä¹Ÿè¢«ç§°ä¸º<mark>å…¨å±€åç§»è¡¨(Global Offset Table, GOT)</mark>ï¼Œå½“ä»£ç éœ€è¦å¼•ç”¨è¯¥å˜é‡æ—¶ï¼Œå¯ä»¥é€šè¿‡GOTä¸­ç›¸å¯¹åº”çš„é¡¹é—´æ¥å¼•ç”¨ã€‚å¦‚å›¾:</p><figure><img src="/image/linker/chapter05/æ¨¡å—é—´æ•°æ®è®¿é—®.png" alt="æ¨¡å—é—´æ•°æ®è®¿é—®" tabindex="0" loading="lazy"><figcaption>æ¨¡å—é—´æ•°æ®è®¿é—®</figcaption></figure><p>å½“æŒ‡ä»¤éœ€è¦è®¿é—®å˜é‡bæ—¶ï¼Œç¨‹åºä¼šå…ˆæ‰¾åˆ°GOTï¼Œç„¶åæ ¹æ®GOTä¸­å˜é‡æ‰€å¯¹åº”çš„é¡¹æ‰¾åˆ°å˜é‡çš„ç›®æ ‡åœ°å€ã€‚é“¾æ¥å™¨åœ¨è£…è½½æ¨¡å—çš„æ—¶å€™ä¼šæŸ¥æ‰¾æ¯ä¸ªå˜é‡æ‰€åœ¨çš„åœ°å€ï¼Œç„¶åå¡«å……GOTä¸­çš„å„ä¸ªé¡¹ï¼Œä»¥ç¡®ä¿æ¯ä¸ªæŒ‡é’ˆæ‰€æŒ‡å‘çš„åœ°å€æ­£ç¡®ã€‚<mark>ç”±äºGOTæœ¬èº«æ˜¯æ”¾åœ¨æ•°æ®æ®µçš„ï¼Œæ‰€ä»¥å®ƒå¯ä»¥åœ¨æ¨¡å—è£…è½½æ—¶è¢«ä¿®æ”¹ï¼Œå¹¶ä¸”æ¯ä¸ªè¿›ç¨‹éƒ½å¯ä»¥æœ‰ç‹¬ç«‹çš„å‰¯æœ¬ï¼Œç›¸äº’ä¸å—å½±å“</mark>ã€‚</p><div class="hint-container important"><p class="hint-container-title">é‡è¦</p><p>GOTæ˜¯å¦‚ä½•å®ç°æŒ‡ä»¤çš„åœ°å€æ— å…³æ€§çš„ã€‚æ¨¡å—åœ¨ç¼–è¯‘æ—¶å¯ä»¥ç¡®å®šæ¨¡å—å†…éƒ¨å˜é‡ç›¸å¯¹äºå½“å‰æŒ‡ä»¤çš„åç§»ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ç¼–è¯‘æ—¶ç¡®å®šGOTç›¸å¯¹äºå½“å‰æŒ‡ä»¤çš„åç§»ã€‚ç¡®å®šGOTçš„ä½ç½®å’Œä¸Šé¢çš„è®¿é—®å˜é‡açš„æ–¹æ³•åŸºæœ¬ä¸€æ ·ï¼Œé€šè¿‡å¾—åˆ°PCå€¼ç„¶ååŠ ä¸Šåç§»é‡ï¼Œå°±å¯ä»¥å¾—åˆ°GOTçš„ä½ç½®ã€‚ç„¶åæˆ‘ä»¬æ ¹æ®å˜é‡åœ°å€åœ¨GOTä¸­çš„åç§»é‡å°±å¯ä»¥å¾—åˆ°å˜é‡çš„åœ°å€ï¼Œå½“ç„¶GOTä¸­æ¯ä¸ªåœ°å€å¯¹åº”äºå“ªä¸ªå˜é‡æ˜¯ç”±ç¼–è¯‘å™¨å†³å®šçš„ï¼Œæ¯”å¦‚ç¬¬ä¸€ä¸ªåœ°å€å¯¹åº”å˜é‡bï¼Œç¬¬äºŒä¸ªå˜é‡å¯¹åº”å˜é‡cç­‰ã€‚</p></div><p>å‡è®¾å…±äº«åº“è¢«åŠ è½½åˆ°0x100000000çš„ä½ç½®ï¼Œè§‚å¯Ÿå‡½æ•°bar()çš„åæ±‡ç¼–ä»£ç ã€‚ä¸ºè®¿é—®å˜é‡bï¼Œç¨‹åºé¦–å…ˆè®¡ç®—å‡ºå˜é‡bçš„åœ°å€åœ¨GOTä¸­çš„ä½ç½®ï¼Œå³0x10000000 + 0x114e + 0x2e72 = 0x10003fc0</p><p>æŸ¥çœ‹GOTä½ç½®</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">readelf</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -S</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> libpic.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">There</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> are</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 27</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> section</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> headers,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> starting</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> at</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> offset</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 0x3548:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Section</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Headers:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  [Nr] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Name</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">              Type</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">             Address</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">           Offset</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">       Size</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">              EntSize</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          Flags</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  Link</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  Info</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  Align</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  [19] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">.got</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">              PROGBITS</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         0000000000003fc0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  00002fc0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">       0000000000000028</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  0000000000000008</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  WA</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">       0</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     0</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     8</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>GOTåœ¨æ–‡ä»¶ä¸­çš„åç§»ä¸º0x3fc0ã€‚æŸ¥çœ‹åŠ¨æ€é“¾æ¥æ—¶é‡å®šä½é¡¹ã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">readelf</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> libpic.so</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Relocation</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> section</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;.rela.dyn&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> at</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> offset</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x458</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> contains</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 8</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> entries:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  Offset</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          Info</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">           Type</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">           Sym.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Value</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    Sym.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Name</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> +</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Addend</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  ...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  000000003fc0</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  000200000006</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> R_X86_64_GLOB_DAT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0000000000000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> b</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è§‚å¯Ÿåˆ°å˜é‡bçš„åœ°å€éœ€è¦é‡å®šä½ï¼Œå®ƒä½äº0x3fc0ï¼Œä¹Ÿå°±æ˜¯GOTä¸­åç§»0ï¼Œç›¸å½“äºæ˜¯GOTä¸­çš„ç¬¬ä¸€é¡¹ï¼ˆæ¯8å­—èŠ‚ä¸€é¡¹ï¼‰æ­£å¥½å¯¹åº”é€šè¿‡æŒ‡ä»¤è®¡ç®—å‡ºçš„åç§»é‡0x114e + 0x2e72 = 0x3fc0ã€‚</p><p><strong>ç±»å‹å›› æ¨¡å—é—´è°ƒç”¨ã€è·³è½¬</strong><br> å¯¹äºæ¨¡å—é—´è°ƒç”¨å’Œè·³è½¬ï¼ŒåŒæ ·å¯ä»¥é‡‡ç”¨ç±»å‹ä¸‰çš„æ–¹æ³•æ¥è§£å†³ã€‚ä½†æ˜¯ä¸åŒçš„æ˜¯ï¼ŒGOTä¸­ç›¸åº”çš„é¡¹ä¿å­˜çš„æ˜¯ç›®æ ‡å‡½æ•°çš„åœ°å€ï¼Œå½“æ¨¡å—éœ€è¦è°ƒç”¨ç›®æ ‡å‡½æ•°æ—¶ï¼Œå¯ä»¥é€šè¿‡GOTä¸­çš„é¡¹è¿›è¡Œé—´æ¥è·³è½¬åŸºæœ¬åŸç†å¦‚ä¸‹å›¾(è¿™æ˜¯åŸä¹¦å¯å‡ºçš„å¯èƒ½ä¼šå’Œå®é™…ä¸åŒï¼Œä½†æ˜¯ä¸å½±å“æˆ‘ä»¬è¿›è¡Œåˆ†æ):</p><figure><img src="/image/linker/chapter05/æ¨¡å—é—´è°ƒç”¨ã€è·³è½¬.png" alt="æ¨¡å—é—´è°ƒç”¨ã€è·³è½¬" tabindex="0" loading="lazy"><figcaption>æ¨¡å—é—´è°ƒç”¨ã€è·³è½¬</figcaption></figure><div class="language-asm line-numbers-mode" data-highlighter="shiki" data-ext="asm" data-title="asm" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">0000000000001060</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &lt;ext@plt&gt;:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1060</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       f3 0f 1e fa             </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">endbr64</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1064</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       ff </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">25</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 96</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> 2f </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">       jmp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    *</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0x2f96</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)       </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> # 4000 &lt;ext&gt;</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">    106a:</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">       66</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> 0f 1f </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">44</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">       nopw   </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0x0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rax</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rax</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">0000000000001155</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &lt;foo&gt;:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1155</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       f3 0f 1e fa             </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">endbr64</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1159</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">48</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 83</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ec </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">08</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">             sub</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    $0x8</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rsp</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    115d</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       b8 </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">          mov</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    $0x0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">eax</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1162</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       e8 </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">09</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ff ff ff          </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">call</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">   1070</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &lt;bar@plt&gt;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1167</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       b8 </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">          mov</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    $0x0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">eax</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">    116c:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">       e8 ef fe ff ff          </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">call</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">   1060</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &lt;ext@plt&gt;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1171</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">48</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 83</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> c4 </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">08</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">             add</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    $0x8</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rsp</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1175</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       c3                      </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">ret</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è§‚å¯Ÿåˆ°è°ƒç”¨ext()å‡½æ•°æ—¶è·³è½¬åˆ°äº†&quot;ext@plt&quot;è°ƒç”¨ï¼Œè€Œè¯¥å‡½æ•°å†…éƒ¨å®ç°ä¾æ—§æ˜¯è·³è½¬åˆ°GOTè¡¨ä¸­é€šè¿‡é—´æ¥è·³è½¬å®ç°å¯¹å‡½æ•°çš„è°ƒç”¨(0x1064ä»£ç å¤„è°ƒç”¨)ã€‚</p><div class="hint-container note"><p class="hint-container-title">æ³¨</p><p>é€šè¿‡å®é™…çš„åˆ†æå‘ç°å‡½æ•°çš„GOTè¡¨å¹¶ä¸åœ¨.gotæ®µä¸­è€Œæ˜¯åœ¨ä¸€ä¸ªåä¸º.got.pltæ®µä¸­(å»¶è¿Ÿç»‘å®š)è¿™æ˜¯å¯¹æ¨¡å—é—´è°ƒç”¨ã€è·³è½¬çš„ä¸€ç§ä¼˜åŒ–ã€‚</p></div><p><strong>-fpicå’Œ-fPIC</strong><br> ä»åŠŸèƒ½ä¸Šæ¥è¯´å®Œå…¨ä¸€æ ·ï¼Œéƒ½æ˜¯ç”Ÿæˆåœ°å€æ— å…³ä»£ç ï¼Œâ€œ-fPICâ€ç”Ÿæˆçš„ä»£ç è¦å¤§ï¼Œè€Œâ€œf-picâ€ç”Ÿæˆçš„ä»£ç è¦å°ï¼Œè€Œä¸”è¾ƒå¿«ã€‚ä½†æ˜¯ç”±äºåœ°å€æ— å…³ä»£ç éƒ½æ˜¯å’Œç¡¬ä»¶å¹³å°ç›¸å…³çš„ï¼Œä¸åŒçš„å¹³å°æœ‰ç€ä¸åŒçš„å®ç°ï¼Œâ€œ-fpicâ€åœ¨æŸäº›å¹³å°ä¸Šä¼šæœ‰ä¸€äº›é™åˆ¶ï¼Œæ¯”å¦‚å…¨å±€ç¬¦å·çš„æ•°é‡æˆ–è€…ä»£ç çš„é•¿åº¦ç­‰ï¼Œè€Œâ€œ-fPICâ€åˆ™æ²¡æœ‰è¿™æ ·çš„é™åˆ¶ã€‚æ‰€ä»¥ä¸ºäº†æ–¹ä¾¿ï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½ä½¿ç”¨â€-fPICâ€œã€‚</p><p><strong>PICå’ŒPIE</strong><br> ä¸€ä¸ªä»¥åœ°å€æ— å…³æ–¹å¼ç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶è¢«ç§°ä¸º<mark>åœ°å€æ— å…³å¯æ‰§è¡Œæ–‡ä»¶(PIE, Position-Independent Executable)</mark>ã€‚å¯¹åº”GCCé€‰é¡¹&quot;-fpie&quot;æˆ–&quot;-fPIE&quot;ã€‚</p><h3 id="_3-4-å…±äº«æ¨¡å—çš„å…¨å±€å˜é‡é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_3-4-å…±äº«æ¨¡å—çš„å…¨å±€å˜é‡é—®é¢˜"><span>3.4 å…±äº«æ¨¡å—çš„å…¨å±€å˜é‡é—®é¢˜</span></a></h3><p>å½“ä¸€ä¸ªæ¨¡å—å¼•ç”¨äº†ä¸€ä¸ªå®šä¹‰åœ¨å…±äº«å¯¹è±¡çš„å…¨å±€å˜é‡çš„æ—¶æ¯”å¦‚ä¸€ä¸ªå…±äº«å¯¹è±¡å®šä¹‰äº†ä¸€ä¸ªå…¨å±€å˜é‡globalï¼Œè€Œæ¨¡å—module.cæ˜¯è¿™æ ·å¼•ç”¨çš„ï¼š</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">extern</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> global;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> foo</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  global </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ç¼–è¯‘å™¨ç¼–è¯‘moudule.cæ—¶ï¼Œæ— æ³•æ ¹æ®è¿™ä¸ªä¸Šä¸‹æ–‡åˆ¤æ–­globalæ˜¯å®šä¹‰åœ¨åŒä¸€ä¸ªæ¨¡å—çš„å…¶å®ƒç›®æ ‡æ–‡ä»¶è¿˜æ˜¯å®šä¹‰åœ¨å¦ä¸€ä¸ªæ¨¡å—å½“ä¸­ï¼Œæ—¢æ— æ³•åˆ¤æ–­æ˜¯å¦ä¸ºè·¨æ¨¡å—é—´çš„è°ƒç”¨ã€‚</p><ol><li>å‡è®¾module.cæ˜¯ç¨‹åºå¯æ‰§è¡Œæ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹ï¼Œç”±äºç¨‹åºä¸»æ¨¡å—çš„ä»£ç å¹¶ä¸æ˜¯åœ°å€æ— å…³ä»£ç ï¼Œä¹Ÿå°±æ˜¯è¯´ä»£ç ä¸ä¼šä½¿ç”¨è¿™ç§PICæœºåˆ¶ï¼Œå®ƒå¼•ç”¨è¿™ä¸ªå…¨å±€å˜é‡çš„æ–¹å¼å’Œæ™®é€šæ•°æ®è®¿é—®æ–¹å¼ä¸€æ ·ï¼Œç¼–è¯‘å™¨ä¼šäº§ç”Ÿè¿™æ ·çš„ä»£ç ï¼š</li></ol><div class="language-asm line-numbers-mode" data-highlighter="shiki" data-ext="asm" data-title="asm" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">movq</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $0x1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, XXXXXXXXXXXXXXXX</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> # XXXXXXXXXXXXXXXXä¸ºglobalçš„åœ°å€ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç”±äºå¯æ‰§è¡Œæ–‡ä»¶åœ¨è¿è¡Œæ—¶å¹¶ä¸è¿›è¡Œä»£ç é‡å®šä½ï¼Œæ‰€ä»¥å˜é‡çš„åœ°å€å¿…é¡»åœ¨é“¾æ¥è¿‡ç¨‹ä¸­ç¡®å®šä¸‹æ¥ã€‚ä¸ºäº†èƒ½å¤Ÿä½¿å¾—é“¾æ¥è¿‡ç¨‹æ­£å¸¸è¿›è¡Œï¼Œé“¾æ¥å™¨ä¼šåœ¨åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œ<mark>åœ¨å®ƒçš„&quot;.bss&quot;æ®µåˆ›å»ºä¸€ä¸ªglobalå˜é‡çš„å‰¯æœ¬</mark>ã€‚é‚£ä¹ˆç°åœ¨globalå˜é‡å®šä¹‰åœ¨åŸå…ˆçš„å…±äº«å¯¹è±¡ä¸­ï¼Œè€Œåœ¨å¯æ‰§è¡Œæ–‡ä»¶çš„&quot;.bss&quot;æ®µè¿˜æœ‰ä¸€ä¸ªå‰¯æœ¬ã€‚å¦‚æœåŒä¸€ä¸ªå˜é‡åŒæ—¶å­˜åœ¨äºå¤šä¸ªä½ç½®ä¸­ï¼Œè¿™åœ¨ç¨‹åºå®é™…è¿è¡Œè¿‡ç¨‹ä¸­è‚¯å®šæ˜¯ä¸å¯è¡Œçš„ã€‚</p><p>å¦‚ä½•è§£å†³ï¼Ÿ<mark>é‚£å°±æ˜¯æ‰€æœ‰çš„ä½¿ç”¨è¿™ä¸ªå˜é‡çš„æŒ‡ä»¤éƒ½æŒ‡å‘ä½äºå¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„é‚£ä¸ªå‰¯æœ¬</mark>ã€‚ELFå…±äº«åº“åœ¨ç¼–è¯‘æ—¶ï¼Œ<mark>é»˜è®¤éƒ½æŠŠå®šä¹‰åœ¨æ¨¡å—å†…éƒ¨çš„å…¨å±€å˜é‡å½“ä½œå®šä¹‰åœ¨å…¶å®ƒæ¨¡å—çš„å…¨å±€å˜é‡</mark>ï¼Œä¹Ÿå°±æ˜¯<mark>ç±»å‹å›› æ¨¡å—é—´å˜é‡è®¿é—®ï¼Œé€šè¿‡GOTæ¥å®ç°å˜é‡è®¿é—®</mark>ã€‚å½“å…±äº«æ¨¡å—è¢«è£…è½½æ—¶ï¼Œ<mark>å¦‚æœæŸä¸ªå…¨å±€å˜é‡åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­æ‹¥æœ‰å‰¯æœ¬ï¼Œé‚£ä¹ˆåŠ¨æ€é“¾æ¥å™¨å°±ä¼šæŠŠGOTä¸­çš„ç›¸åº”åœ°å€æŒ‡å‘è¯¥å‰¯æœ¬ï¼Œè¿™æ ·è¯¥å˜é‡åœ¨è¿è¡Œæ—¶å®é™…ä¸Šæœ€ç»ˆåªæœ‰ä¸€ä¸ªå®ä¾‹</mark>ã€‚å¦‚æœå˜é‡åœ¨å…±äº«æ¨¡å—ä¸­è¢«åˆå§‹åŒ–ï¼Œé‚£ä¹ˆ<mark>åŠ¨æ€é“¾æ¥å™¨è¿˜éœ€è¦å°†è¯¥åˆå§‹åŒ–å€¼å¤åˆ¶åˆ°ç¨‹åºä¸»æ¨¡å—ä¸­çš„å˜é‡å‰¯æœ¬</mark>ï¼›å¦‚æœè¯¥å…¨å±€å˜é‡åœ¨ç¨‹åºä¸»æ¨¡å—ä¸­æ²¡æœ‰å‰¯æœ¬ï¼Œé‚£ä¹ˆ<mark>GOTä¸­ç›¸åº”åœ°å€å°±æŒ‡å‘æ¨¡å—å†…éƒ¨çš„è¯¥å˜é‡å‰¯æœ¬</mark>ã€‚</p><ol start="2"><li>å¦‚æœmodule.cæ˜¯å…±äº«å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆGCCç¼–è¯‘å™¨åœ¨-fPICçš„æƒ…å†µä¸‹ï¼Œå°±ä¼šæŠŠå¯¹globalçš„è°ƒç”¨æŒ‰ç…§è·¨æ¨¡å—æ¨¡å¼äº§ç”Ÿä»£ç ã€‚å› ä¸ºç¼–è¯‘å™¨æ— æ³•ç¡®å®šå¯¹globalçš„å¼•ç”¨æ˜¯è·¨æ¨¡å—çš„è¿˜æ˜¯æ¨¡å—å†…éƒ¨çš„ã€‚å³ä½¿æ˜¯æ¨¡å—å†…éƒ¨çš„ï¼Œè¿˜æ˜¯ä¼šäº§ç”Ÿè·¨æ¨¡å—ä»£ç ï¼Œå› ä¸ºglobalå¯èƒ½è¢«å¯æ‰§è¡Œæ–‡ä»¶å¼•ç”¨ï¼Œä»è€Œä½¿å¾—å…±äº«æ¨¡å—ä¸­å¯¹globalçš„å¼•ç”¨è¦æ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„globaå‰¯æœ¬ã€‚</li></ol><h3 id="_3-5-æ•°æ®æ®µåœ°å€æ— å…³æ€§" tabindex="-1"><a class="header-anchor" href="#_3-5-æ•°æ®æ®µåœ°å€æ— å…³æ€§"><span>3.5 æ•°æ®æ®µåœ°å€æ— å…³æ€§</span></a></h3><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> a;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">p </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">a;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæŸä¸ªå…±äº«å¯¹è±¡é‡Œæœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼Œé‚£ä¹ˆpçš„åœ°å€å°±æ˜¯ä¸€ä¸ªç»å¯¹åœ°å€ï¼Œå®ƒæŒ‡å‘å˜é‡aï¼Œè€Œå˜é‡açš„åœ°å€ä¼šéšç€å…±äº«å¯¹è±¡çš„è£…è½½åœ°å€æ”¹å˜è€Œæ”¹å˜ã€‚</p><p>å¯¹äºæ•°æ®æ®µæ¥è¯´ï¼Œå®ƒåœ¨æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä»½ç‹¬ç«‹çš„å‰¯æœ¬ï¼Œæ‰€ä»¥å¹¶ä¸æ‹…å¿ƒè¢«è¿›ç¨‹æ”¹å˜ã€‚ä»è¿™ç‚¹æ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©è£…è½½æ—¶é‡å®šä½çš„æ–¹æ³•æ¥è§£å†³æ•°æ®æ®µä¸­ç»å¯¹åœ°å€å¼•ç”¨é—®é¢˜ã€‚å¯¹äºå…±äº«å¯¹è±¡æ¥è¯´ï¼Œå¦‚æœæ•°æ®æ®µä¸­æœ‰ç»å¯¹åœ°å€å¼•ç”¨ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å’Œé“¾æ¥å™¨å°±ä¼šäº§ç”Ÿä¸€ä¸ªé‡å®šä½è¡¨ï¼Œè¿™ä¸ªé‡å®šä½è¡¨é‡Œé¢é‡Œé¢åŒ…å«äº†â€œR_X86_64_GLOB_DAT&quot;ç±»å‹çš„é‡å®šä½å…¥å£ï¼Œç”¨äºè§£å†³ä¸Šè¿°é—®é¢˜ã€‚å½“åŠ¨æ€é“¾æ¥å™¨è£…è½½å…±äº«å¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°è¯¥å…±äº«å¯¹è±¡æœ‰è¿™æ ·çš„é‡å®šä½å…¥å£ï¼Œé‚£ä¹ˆåŠ¨æ€é“¾æ¥å™¨å°±ä¼šå¯¹è¯¥å…±äº«å¯¹è±¡è¿›è¡Œé‡å®šä½ã€‚</p><h2 id="_4-å»¶è¿Ÿç»‘å®š-plt" tabindex="-1"><a class="header-anchor" href="#_4-å»¶è¿Ÿç»‘å®š-plt"><span>4. å»¶è¿Ÿç»‘å®š(PLT)</span></a></h2><p>åŠ¨æ€é“¾æ¥åº“æ¯”é™æ€é“¾æ¥æ…¢çš„ä¸»è¦åŸå› ï¼š</p><ul><li>åŠ¨æ€é“¾æ¥ä¸‹å¯¹äºå…¨å±€å’Œé™æ€çš„æ•°æ®è®¿é—®éƒ½è¦è¿›è¡Œå¤æ‚çš„GOTå®šä½ï¼Œç„¶åé—´æ¥å¯»å€ï¼Œå¯¹äºæ¨¡å—é—´çš„è°ƒç”¨ä¹Ÿè¦å…ˆå®šä½GOTï¼Œç„¶åå†è¿›è¡Œé—´æ¥è·³è½¬ã€‚</li><li>åŠ¨æ€é“¾æ¥çš„é“¾æ¥å·¥ä½œåœ¨è¿è¡Œæ—¶å®Œæˆï¼Œå³ç¨‹åºå¼€å§‹æ‰§è¡Œæ—¶ï¼ŒåŠ¨æ€é“¾æ¥å™¨éƒ½è¦è¿›è¡Œä¸€æ¬¡é“¾æ¥å·¥ä½œï¼ŒåŠ¨æ€é“¾æ¥å™¨ä¼šå¯»æ‰¾æ–Œè£…è½½æ‰€éœ€è¦çš„å…±äº«å¯¹è±¡ï¼Œç„¶åè¿›è¡Œç¬¦å·æŸ¥æ‰¾åœ°å€é‡å®šä½ç­‰å·¥ä½œã€‚</li></ul><p><strong>å»¶è¿Ÿç»‘å®šå®ç°</strong><br> åœ¨åŠ¨æ€é“¾æ¥ä¸‹ï¼Œç¨‹åºæ¨¡å—ä¹‹é—´åŒ…å«äº†å¤§é‡çš„å‡½æ•°å¼•ç”¨(å…¨å±€å˜é‡å¾€å¾€æ¯”è¾ƒå°‘ï¼Œå› ä¸ºå¤§é‡çš„å…¨å±€å˜é‡ä¼šå¯¼è‡´æ¨¡å—é—´è€¦åˆåº¦å˜å¤§)ï¼Œæ‰€ä»¥åœ¨ç¨‹åºå¼€å§‹æ‰§è¡Œå‰ï¼ŒåŠ¨æ€é“¾æ¥ä¼šè€—è´¹ä¸å°‘æ—¶é—´ç”¨äºè§£å†³æ¨¡å—ä¹‹é—´çš„å‡½æ•°å¼•ç”¨çš„ç¬¦å·æŸ¥æ‰¾å’Œé‡å®šä½ã€‚ä¸è¿‡å¯ä»¥æƒ³è±¡ï¼Œåœ¨ä¸€ä¸ªç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½å¾ˆå¤šå‡½æ•°åœ¨ç¨‹åºæ‰§è¡Œå®Œæ—¶éƒ½ä¸ä¼šè¢«ç”¨åˆ°ï¼Œæ¯”å¦‚ä¸€äº›é”™è¯¯å¤„ç†å‡½æ•°æˆ–è€…æ˜¯ä¸€äº›ç”¨æˆ·å¾ˆå°‘ç”¨åˆ°çš„åŠŸèƒ½æ¨¡å—ç­‰ï¼Œå¦‚æœä¸€å¼€å§‹å°±æŠŠæ‰€æœ‰å‡½æ•°éƒ½é“¾æ¥å¥½å®é™…ä¸Šæ˜¯ä¸€ç§æµªè´¹ã€‚æ‰€ä»¥ELFé‡‡ç”¨äº†ä¸€ç§å« <mark>å»¶è¿Ÿç»‘å®š(Lazy Binding)</mark> çš„åšæ³•,å…¶åŸºæœ¬æ€æƒ³æ˜¯å½“<mark>å‡½æ•°ç¬¬ä¸€æ¬¡è¢«ç”¨åˆ°æ—¶æ‰è¿›è¡Œç»‘å®š(ç¬¦å·æŸ¥æ‰¾ã€é‡å®šä½ç­‰)</mark>ï¼Œå¦‚æœæ²¡æœ‰ç”¨åˆ°åˆ™ä¸è¿›è¡Œç»‘å®šã€‚æ‰€ä»¥ç¨‹åºå¼€å§‹æ‰§è¡Œæ—¶ï¼Œæ¨¡å—é—´çš„å‡½æ•°è°ƒç”¨éƒ½æ²¡æœ‰è¿›è¡Œç»‘å®šï¼Œè€Œæ˜¯éœ€è¦ç”¨åˆ°æ—¶æ‰ç”±åŠ¨æ€é“¾æ¥å™¨æ¥è´Ÿè´£ç»‘å®šã€‚</p><p>ELFä½¿ç”¨ <mark>PLT(Procedure Linkage Table)</mark> çš„æ–¹æ³•æ¥å®ç°ï¼Œè¿™ç§æ–¹æ³•ä½¿ç”¨äº†ä¸€äº›ç²¾å·§çš„æŒ‡ä»¤åºåˆ—æ¥å®Œæˆã€‚</p><div class="hint-container note"><p class="hint-container-title">æ³¨</p><p>å‡è®¾liba.soéœ€è¦è°ƒç”¨libc.soä¸­çš„bar()å‡½æ•°ï¼Œé‚£ä¹ˆå½“liba.soä¸­ç¬¬ä¸€æ¬¡è°ƒç”¨bar()æ—¶ï¼Œè¿™æ—¶å€™å°±éœ€è¦è°ƒç”¨åŠ¨æ€é“¾æ¥å™¨ä¸­çš„æŸä¸ªå‡½æ•°æ¥å®Œæˆåœ°å€ç»‘å®šå·¥ä½œï¼Œæˆ‘ä»¬å‡è®¾è¿™ä¸ªå‡½æ•°å«åšlookup()ï¼Œé‚£ä¹ˆlookup()éœ€è¦çŸ¥é“ä¸€äº›å¿…è¦ä¿¡æ¯æ‰èƒ½å®Œæˆè¿™ä¸ªå‡½æ•°åœ°å€ç»‘å®šçš„å·¥ä½œ:</p><ul><li>åœ°å€ç»‘å®šå‘ç”Ÿåœ¨å“ªä¸ªæ¨¡å—ï¼Œå“ªä¸ªå‡½æ•°ã€‚<br> å‡è®¾lookupçš„åŸå‹ä¸ºlookup(module, function)ï¼Œè¿™ä¸¤ä¸ªå‚æ•°çš„å€¼åœ¨æˆ‘ä»¬çš„åˆ—å­ä¸­åˆ†åˆ«ä¸ºliba.soå’Œbar()ã€‚åœ¨Glibcä¸­ï¼Œæˆ‘ä»¬è¿™é‡Œçš„lookup()å‡½æ•°æ­£åœ¨çš„åå­—å«åš_dl_runtime_resolve()ã€‚</li></ul></div><p>å½“æˆ‘ä»¬è°ƒç”¨æŸä¸ªå¤–éƒ¨æ¨¡å—çš„å‡½æ•°æ—¶ï¼Œå¦‚æœæŒ‰ç…§é€šå¸¸çš„åšæ³•åº”è¯¥æ—¶é€šè¿‡GOTä¸­ç›¸åº”çš„é¡¹è¿›è¡Œé—´æ¥è·³è½¬ã€‚PLTä¸ºäº†å®ç°å»¶è¿Ÿç»‘å®šï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­é—´åˆå¢åŠ äº†ä¸€å±‚é—´æ¥è·³è½¬ã€‚è°ƒç”¨å‡½æ•°å¹¶ä¸ç›´æ¥é€šè¿‡GOTè·³è½¬ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªå«åšPLTé¡¹çš„ç»“æ„æ¥è¿›è¡Œè·³è½¬ã€‚æ¯ä¸ªå¤–éƒ¨å‡½æ•°åœ¨PLTä¸­éƒ½æœ‰ä¸€ä¸ªç›¸åº”çš„é¡¹ï¼Œæ¯”å¦‚bar()å‡½æ•°åœ¨PLTä¸­çš„é¡¹æˆ‘ä»¬ç§°ä¹‹ä¸ºbar@pltã€‚</p><div class="language-asm line-numbers-mode" data-highlighter="shiki" data-ext="asm" data-title="asm" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">0000000000001070</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &lt;bar@plt&gt;:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1070</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       f3 0f 1e fa             </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">endbr64</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">    1074</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:       ff </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">25</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> 8e 2f </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">       jmp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    *</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0x2f8e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)       </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> # 4008 &lt;bar+0x2ecf&gt;</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">    107a:</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">       66</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> 0f 1f </span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">44</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;"> 00</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">       nopw   </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0x0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rax</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rax</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#C678DD;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container note"><p class="hint-container-title">æ³¨</p><ul><li>è¿‡ç¨‹é“¾æ¥è¡¨(PLT)æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­æ¯ä¸ªæ¡ç›®æ—¶16å­—èŠ‚ä»£ç ã€‚PLT[0]æ—¶ä¸€ä¸ªç‰¹æ®Šæ¡ç›®ï¼Œå®ƒè·³è½¬åˆ°åŠ¨æ€é“¾æ¥åº“ä¸­ã€‚æ¯ä¸ªè¢«å¯æ‰§è¡Œç¨‹åºè°ƒç”¨çš„åº“å‡½æ•°éƒ½æœ‰å®ƒè‡ªå·±çš„PLTæ¡ç›®ã€‚æ¯ä¸ªæ¡ç›®éƒ½è´Ÿè´£è°ƒç”¨ä¸€ä¸ªå…·ä½“çš„å‡½æ•°ã€‚PLT[1]è°ƒç”¨ç³»ç»Ÿå¯åŠ¨å‡½æ•°(__libc_start_main)ï¼Œå®ƒåˆå§‹åŒ–æ‰§è¡Œç¯å¢ƒã€‚ä»PLT[2]å¼€å§‹çš„æ¡ç›®è°ƒç”¨ç”¨æˆ·ä»£ç è°ƒç”¨çš„å‡½æ•°ã€‚</li><li>å…¨å±€åç§»è¡¨(GOT)æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­æ¯ä¸ªæ¡ç›®æ—¶8å­—èŠ‚åœ°å€ã€‚å’ŒPLTè”åˆä½¿ç”¨æ—¶ï¼ŒGOT[0]å’ŒGOT[1]åŒ…å«åŠ¨æ€é“¾æ¥å™¨åœ¨è§£æå‡½æ•°åœ°å€æ—¶ä¼šä½¿ç”¨çš„ä¿¡æ¯ã€‚GOT[2]æ˜¯åŠ¨æ€é“¾æ¥å™¨åœ¨ld-linux.soæ¨¡å—çš„å…¥å£ç‚¹ã€‚å…¶ä½™çš„æ¯ä¸ªæ¡ç›®å¯¹åº”äºä¸€ä¸ªè¢«è°ƒç”¨çš„å‡½æ•°ï¼Œå…¶åœ°å€éœ€è¦åœ¨è¿è¡Œæ˜¯è¢«è§£æã€‚æ¯ä¸ªæ¡ç›®éƒ½æœ‰ä¸€ä¸ªç›¸åŒ¹é…çš„PLTæ¡ç›®ã€‚åˆå§‹æ—¶æ¯ä¸ªGOTæ¡ç›®éƒ½æŒ‡å‘å¯¹åº”PLTæ¡ç›®çš„ç¬¬äºŒæ¡æŒ‡ä»¤ã€‚<br> (å‚è€ƒcsapp 7.12å°èŠ‚)</li></ul></div><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &lt;stdio.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &lt;stdlib.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &lt;dlfcn.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;"> x</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;"> y</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;"> z</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  void</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">handle;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  void</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">addvec) (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  char</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">error;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  handle </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> dlopen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./libvector.so&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, RTLD_LAZY);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">handle) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    fprintf</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(stderr, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">%s</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dlerror</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    exit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  addvec </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> dlsym</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(handle, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;addvec&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ((error </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> dlerror</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    fprintf</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(stderr, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">%s</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, error);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    exit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  addvec</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(x, y, z, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  printf</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;z = [</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">%d</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> %d</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">]</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;">z</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">], </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;">z</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dlclose</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(handle) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    fprintf</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(stderr, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">%s</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dlerror</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    exit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/image/linker/chapter05/got&amp;plt.png" alt="ç”¨PLTå’ŒGOTè°ƒç”¨å¤–éƒ¨å‡½æ•°ã€‚åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨addvecæ—¶ï¼ŒåŠ¨æ€é“¾æ¥å™¨è§£æå®ƒçš„åœ°å€" tabindex="0" loading="lazy"><figcaption>ç”¨PLTå’ŒGOTè°ƒç”¨å¤–éƒ¨å‡½æ•°ã€‚åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨addvecæ—¶ï¼ŒåŠ¨æ€é“¾æ¥å™¨è§£æå®ƒçš„åœ°å€</figcaption></figure><p>å¦‚ä½•ä½¿ç”¨GOTå’ŒPLTååŒå·¥ä½œ:</p><ul><li>addvecç¬¬ä¸€æ¬¡è¢«è°ƒç”¨æ—¶ï¼Œå»¶è¿Ÿè§£æå®ƒçš„è¿è¡Œæ—¶åœ°å€ï¼š <ol><li>ä¸ç›´æ¥è°ƒç”¨addvecï¼Œç¨‹åºè°ƒç”¨è¿›å…¥PLT[2]ï¼Œè¿™æ˜¯addvecçš„PLTæ¡ç›®</li><li>ç¬¬ä¸€æ¡PLTæŒ‡ä»¤é€šè¿‡GOT[4]è¿›è¡Œé—´æ¥è·³è½¬ã€‚å› ä¸ºæ¯ä¸ªGOTæ¡ç›®åˆå§‹åŒ–æ—¶éƒ½æŒ‡å‘å®ƒå¯¹åº”çš„PLTæ¡ç›®çš„ç¬¬äºŒæ¡æŒ‡ä»¤ï¼Œè¿™ä¸ªé—´æ¥è·³è½¬åªæ˜¯ç®€å•çš„æŠŠæ§åˆ¶ä¼ é€å›PLT[2]ä¸­çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚</li><li>åœ¨æŠŠaddvecçš„IDï¼ˆ0x1ï¼‰å‹å…¥æ ˆä¸­ä¹‹åï¼ŒPLT[2]è·³è½¬åˆ°PLT[0]ã€‚</li><li>PLT[0]é€šè¿‡GOT[1]é—´æ¥çš„æŠŠåŠ¨æ€é“¾æ¥å™¨çš„ä¸€ä¸ªå‚æ•°å‹å…¥æ ˆä¸­ï¼Œç„¶åé€šè¿‡GOT[2]é—´æ¥è·³è½¬åˆ°åŠ¨æ€é“¾æ¥å™¨ä¸­ã€‚åŠ¨æ€é“¾æ¥å™¨ä½¿ç”¨ä¸¤ä¸ªæ ˆæ¡ç›®æ¥ç¡®å®šaddvecçš„è¿è¡Œæ—¶ä½ç½®ï¼Œç”¨è¿™ä¸ªåœ°å€é‡æ–°GOT[4]ï¼Œå†æŠŠæ§åˆ¶æƒä¼ é€’ç»™addvecã€‚</li></ol></li><li>åç»­å†è°ƒç”¨addvecæ—¶çš„æ§åˆ¶æµï¼š <ol><li>æ§åˆ¶ä¼ é€’åˆ°PLT[2]ã€‚</li><li>é€šè¿‡GOT[4]çš„é—´æ¥è·³è½¬ä¼šå°†æ§åˆ¶ç›´æ¥è½¬ç§»åˆ°addvecã€‚</li></ol></li></ul><p>PLTåœ¨ELFæ–‡ä»¶ä¸­ä»¥ç‹¬ç«‹çš„æ®µå­˜æ”¾ï¼Œæ®µåå«&quot;.plt&quot;ã€‚å› ä¸ºæœ¬èº«æ˜¯ä¸€äº›åœ°å€æ— å…³ä»£ç ï¼Œæ‰€ä»¥å¯ä»¥å’Œä»£ç æ®µç­‰ä¸€èµ·åˆå¹¶æˆåŒä¸€ä¸ªå¯è¯»å¯æŒ‡å‘çš„â€œsegmentâ€è¢«è£…è½½å…¥å†…å­˜ã€‚</p><h2 id="_5-åŠ¨æ€é“¾æ¥ç›¸å…³ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_5-åŠ¨æ€é“¾æ¥ç›¸å…³ç»“æ„"><span>5. åŠ¨æ€é“¾æ¥ç›¸å…³ç»“æ„</span></a></h2><p>åŠ¨æ€é“¾æ¥æƒ…å†µä¸‹ï¼Œå¯æ‰§è¡Œæ–‡ä»¶çš„è£…è½½ä¸é™æ€é“¾æ¥æƒ…å†µåŸºæœ¬ä¸€æ ·ã€‚é¦–å…ˆæ“ä½œç³»ç»Ÿä¼šè¯»å–å¯æ‰§è¡Œæ–‡ä»¶çš„å¤´éƒ¨ï¼Œæ£€æŸ¥æ–‡ä»¶çš„åˆæ³•æ€§ï¼Œç„¶åä»å¤´éƒ¨ä¸­çš„ <mark>&quot;Program Header&quot;</mark> ä¸­è¯»å–æ¯ä¸ª <mark>&quot;Segment&quot;</mark> çš„è™šæ‹Ÿåœ°å€ã€æ–‡ä»¶åœ°å€å’Œå±æ€§ï¼Œå¹¶å°†å®ƒä»¬æ˜ å°„åˆ°è¿›ç¨‹è™šæ‹Ÿç©ºé—´çš„ç›¸åº”ä½ç½®ï¼Œè¿™äº›æ­¥éª¤å’Œé™æ€é“¾æ¥æƒ…å†µä¸‹çš„è£…è½½åŸºæœ¬æ— å¼‚ã€‚åœ¨é™æ€é“¾æ¥æƒ…å†µä¸‹ï¼Œæ“ä½œç³»ç»Ÿæ¥ç€å°±å¯ä»¥æŠŠæ§åˆ¶æƒäº¤ç»™å¯æ‰§è¡Œæ–‡ä»¶çš„å…¥å£åœ°å€ï¼Œç„¶åç¨‹åºå¼€å§‹æ‰§è¡Œã€‚</p><p>å¯æ˜¯åœ¨åŠ¨æ€é“¾æ¥æƒ…å†µä¸‹ï¼Œæ“ä½œç³»ç»Ÿè¿˜ä¸èƒ½åœ¨è£…è½½å®Œå¯æ‰§è¡Œæ–‡ä»¶ä¹‹åå°±æŠŠæ§åˆ¶æƒäº¤ç»™å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå› ä¸ºå¯æ‰§è¡Œæ–‡ä»¶<mark>ä¾èµ–äºå¾ˆå¤šå…±äº«å¯¹è±¡</mark>ã€‚è¿™æ—¶ï¼Œå¯æ‰§è¡Œæ–‡ä»¶å¯¹äºå¾ˆå¤š <mark>å¤–éƒ¨ç¬¦å·çš„å¼•ç”¨è¿˜å¤„äºæ— æ•ˆåœ°å€çš„çŠ¶æ€</mark>ï¼Œæ—¢è¿˜æ²¡æœ‰å’Œç›¸åº”çš„<mark>å…±äº«å¯¹è±¡ä¸­çš„å®é™…ä½ç½®é“¾æ¥èµ·æ¥</mark>ã€‚æ‰€ä»¥åœ¨æ˜ å°„å®Œå¯æ‰§è¡Œæ–‡ä»¶åï¼Œæ“ä½œç³»ç»Ÿä¼šå…ˆå¯åŠ¨ä¸€ä¸ª<mark>åŠ¨æ€é“¾æ¥å™¨ï¼ˆDynamic Linkerï¼‰</mark>ã€‚</p><p>åœ¨Linuxä¸‹ï¼Œ<mark>åŠ¨æ€é“¾æ¥å™¨ld.soå®é™…ä¸Šæ˜¯ä¸€ä¸ªå…±äº«å¯¹è±¡</mark>ï¼Œæ“ä½œç³»ç»Ÿç»Ÿä¸€é€šè¿‡æ˜ å°„çš„æ–¹å¼å°†å®ƒåŠ è½½åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸­ã€‚æ“ä½œç³»ç»Ÿåœ¨åŠ è½½å®ŒåŠ¨æ€é“¾æ¥å™¨åï¼Œå°†æ§åˆ¶æƒäº¤ç»™<mark>åŠ¨æ€é“¾æ¥å™¨çš„å…¥å£åœ°å€ï¼ˆä¸å¯æ‰§è¡Œæ–‡ä»¶ä¸€æ ·ï¼Œå…±äº«å¯¹è±¡ä¹Ÿæœ‰å…¥å£åœ°å€ï¼‰</mark>ã€‚å½“åŠ¨æ€é“¾æ¥å™¨è·å¾—æ§åˆ¶æƒåï¼Œä¾¿å¼€å§‹ä¸€ç³»åˆ—è‡ªèº«çš„åˆå§‹åŒ–æ“ä½œï¼Œç„¶åæ ¹æ®å½“å‰çš„ç¯å¢ƒå‚æ•°ï¼Œå¼€å§‹å¯¹å¯æ‰§è¡Œæ–‡ä»¶è¿›è¡ŒåŠ¨æ€é“¾æ¥å·¥ä½œã€‚å½“æ‰€æœ‰åŠ¨æ€é“¾æ¥å·¥ä½œå®Œæˆåï¼ŒåŠ¨æ€é“¾æ¥å™¨ä¼šå°†æ§åˆ¶æƒäº¤ç»™å¯æ‰§è¡Œæ–‡ä»¶çš„å…¥å£åœ°å€ï¼Œç¨‹åºå¼€å§‹æ­£å¼æ‰§è¡Œã€‚</p><h3 id="_5-1-interp-æ®µ" tabindex="-1"><a class="header-anchor" href="#_5-1-interp-æ®µ"><span>5.1 &quot;.interp&quot;æ®µ</span></a></h3><div class="hint-container note"><p class="hint-container-title">æ³¨</p><p>åŠ¨æ€é“¾æ¥å»çš„ä½ç½®æ—¢ä¸æ˜¯ç”±ç³»ç»Ÿé…ç½®æŒ‡å®šï¼Œä¹Ÿä¸æ˜¯ç”±ç¯å¢ƒå‚æ•°å†³å®šï¼Œè€Œæ˜¯ç”±ELFå¯æ‰§è¡Œæ–‡ä»¶å†³å®šã€‚åœ¨åŠ¨æ€é“¾æ¥çš„ELFå¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œæœ‰ä¸€ä¸ªä¸“é—¨çš„æ®µå«åš==&quot;.interp&quot;æ®µ(&quot;interp&quot;æ˜¯&quot;interpreter&quot;(è§£é‡Šå™¨)çš„ç¼©å†™)<mark>ã€‚<br> &quot;.interp&quot;é‡Œé¢ä¿æŒçš„å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å°±æ˜¯å¯æ‰§è¡Œæ–‡ä»¶æ‰€éœ€è¦çš„åŠ¨æ€é“¾æ¥å™¨çš„è·¯å¾„ã€‚åœ¨Linuxä¸­ï¼Œæ“ä½œç³»ç»Ÿåœ¨å¯¹å¯æ‰§è¡Œæ–‡ä»¶</mark>è¿›è¡ŒåŠ è½½æ—¶==ï¼Œä¼šå»å¯»å€è£…è½½è¯¥å¯æ‰§è¡Œæ–‡ä»¶æ‰€éœ€è¦ç›¸åº”çš„åŠ¨æ€é“¾æ¥å™¨ï¼Œæ—¢&quot;.interp&quot;æ®µæ‰€æŒ‡å®šçš„è·¯å¾„çš„å…±äº«å¯¹è±¡ã€‚</p></div><p>ä½¿ç”¨objdumpå·¥å…·æŸ¥çœ‹&quot;interp&quot;å†…å®¹ï¼š</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// test.c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &lt;stdio.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  printf</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello world!</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// gcc test.c -o test</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">objdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> test</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">test</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">     file</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> format</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> elf64-x86-64</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Contents</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> section</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .interp:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> 0318</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 2f6c6962</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 36342f6c</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 642d6c69</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 6e75782d</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  /lib64/ld-linux-</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0328</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 7838362d</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 36342e73</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 6f2e3200</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">           x86-64.so.2.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹Ÿå¯ä»¥ä½¿ç”¨readelfæŸ¥çœ‹ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">readelf</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -l</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> test</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .interpreter</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      [Requesting program interpreter: /lib64/ld-linux-x86-64.so.2]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-2-dynamic-æ®µ" tabindex="-1"><a class="header-anchor" href="#_5-2-dynamic-æ®µ"><span>5.2 &quot;.dynamic&quot;æ®µ</span></a></h3><div class="hint-container important"><p class="hint-container-title">é‡è¦</p><p>åŠ¨æ€é“¾æ¥ELFä¸­æœ€é‡è¦çš„ç»“æ„&quot;.dynamic&quot;æ®µï¼Œè¿™ä¸ªæ®µä¿å­˜äº†åŠ¨æ€é“¾æ¥æ‰€éœ€è¦çš„åŸºæœ¬ä¿¡æ¯ï¼Œ<mark>æ¯”å¦‚ä¾èµ–äºé‚£äº›å…±äº«å¯¹è±¡ã€åŠ¨æ€é“¾æ¥ç¬¦å·è¡¨çš„ä½ç½®ã€åŠ¨æ€é“¾æ¥é‡å®šä½è¡¨çš„ä½ç½®ã€å…±äº«å¯¹è±¡åˆå§‹åŒ–ä»£ç çš„åœ°å€ç­‰</mark>ã€‚</p></div><p>&quot;.dynamic&quot;æ®µçš„ç»“æ„ï¼š</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">/* Dynamic section entry.  */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// 32ä½</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  Elf32_Sword   d_tag;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                /* Dynamic entry type */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  union</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    Elf32_Word d_val;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                 /* Integer value */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    Elf32_Addr d_ptr;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                 /* Address value */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } d_un;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} Elf32_Dyn;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// 64ä½</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  Elf64_Sxword  d_tag;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                /* Dynamic entry type */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  union</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    Elf64_Xword d_val;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                /* Integer value */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    Elf64_Addr d_ptr;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                 /* Address value */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } d_un;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} Elf64_Dyn;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>d_tagç±»å‹</th><th>d_unçš„å«ä¹‰</th></tr></thead><tbody><tr><td>DT_SYMTAB</td><td>åŠ¨æ€é“¾æ¥ç¬¦å·è¡¨çš„åœ°å€ï¼Œd_ptrè¡¨ç¤º&quot;.dynsym&quot;çš„åœ°å€</td></tr><tr><td>DT_STRTAB</td><td>åŠ¨æ€é“¾æ¥å­—ç¬¦ä¸²è¡¨åœ°å€ï¼Œd_ptrè¡¨ç¤º&quot;.dynstr&quot;çš„åœ°å€</td></tr><tr><td>DT_STRSZ</td><td>åŠ¨æ€é“¾æ¥å­—ç¬¦ä¸²è¡¨å¤§å°ï¼Œd_valè¡¨ç¤ºå¤§å°</td></tr><tr><td>DT_HASH</td><td>åŠ¨æ€é“¾æ¥å“ˆå¸Œè¡¨åœ°å€ï¼Œd_ptrè¡¨ç¤º&quot;.hash&quot;çš„åœ°å€</td></tr><tr><td>DT_SONAME</td><td>æœ¬å…±äº«å¯¹è±¡çš„&quot;SO-NAME&quot;</td></tr><tr><td>DT_RPATH</td><td>åŠ¨æ€é“¾æ¥å…±äº«å¯¹è±¡æœç´¢è·¯å¾„</td></tr><tr><td>DT_INIT</td><td>åˆå§‹åŒ–ä»£ç åœ°å€</td></tr><tr><td>DT_FINIT</td><td>ç»“æŸä»£ç åœ°å€</td></tr><tr><td>DT_NEED</td><td>ä¾èµ–çš„å…±äº«å¯¹è±¡æ–‡ä»¶ï¼Œd_ptrè¡¨ç¤ºæ‰€ä¾èµ–çš„å…±äº«å¯¹è±¡æ–‡ä»¶å</td></tr><tr><td>DT_REL/DT_RELA</td><td>åŠ¨æ€é“¾æ¥é‡å®šä½è¡¨åœ°å€</td></tr><tr><td>DT_RELENT/DT_RELAENT</td><td>åŠ¨æ€é‡å®šä½è¡¨å…¥å£å‡½æ•°</td></tr></tbody></table><p>ä½¿ç”¨readelfå·¥å…·æŸ¥çœ‹&quot;.dynamic&quot;æ®µçš„å†…å®¹ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">readelf</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> test</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Dynamic</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> section</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> at</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> offset</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x2dc8</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> contains</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 27</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> entries:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  Tag</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        Type</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                         Name/Value</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0x0000000000000001</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (NEEDED)             Shared library: [libc.so.6]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0x000000000000000c</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (INIT)               0x1000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0x000000000000000d</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (FINI)               0x1168</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0x0000000000000019</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (INIT_ARRAY)         0x3db8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0x000000000000001b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (INIT_ARRAYSZ)       8 (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">bytes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0x000000000000001a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (FINI_ARRAY)         0x3dc0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0x000000000000001c</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (FINI_ARRAYSZ)       8 (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">bytes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0x000000006ffffef5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (GNU_HASH)           0x3b0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0x0000000000000005</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (STRTAB)             0x480</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0x0000000000000006</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (SYMTAB)             0x3d8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0x000000000000000a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (STRSZ)              141 (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">bytes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0x000000000000000b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (SYMENT)             24 (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">bytes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0x0000000000000015</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (DEBUG)              0x0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0x0000000000000003</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (PLTGOT)             0x3fb8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0x0000000000000002</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (PLTRELSZ)           24 (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">bytes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0x0000000000000014</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (PLTREL)             RELA</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0x0000000000000017</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (JMPREL)             0x610</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0x0000000000000007</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (RELA)               0x550</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0x0000000000000008</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (RELASZ)             192 (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">bytes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0x0000000000000009</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (RELAENT)            24 (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">bytes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0x000000000000001e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (FLAGS)              BIND_NOW</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0x000000006ffffffb</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (FLAGS_1)            Flags: NOW PIE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0x000000006ffffffe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (VERNEED)            0x520</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0x000000006fffffff</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (VERNEEDNUM)         1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0x000000006ffffff0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (VERSYM)             0x50e</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0x000000006ffffff9</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (RELACOUNT)          3</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  0x0000000000000000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (NULL)               0x0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨lddæŸ¥çœ‹ä¸€ä¸ªç¨‹åºä¸»æ¨¡å—æˆ–ä¸€ä¸ªå…±äº«åº“ä¾èµ–äºå“ªäº›å…±äº«åº“ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">ldd</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> test</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        linux-vdso.so.1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (0x00007ffe6d77b000)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        libc.so.6</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /lib/x86_64-linux-gnu/libc.so.6</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (0x00007f7967314000)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        /lib64/ld-linux-x86-64.so.2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (0x00007f796754d000)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-åŠ¨æ€ç¬¦å·è¡¨" tabindex="-1"><a class="header-anchor" href="#_5-3-åŠ¨æ€ç¬¦å·è¡¨"><span>5.3 åŠ¨æ€ç¬¦å·è¡¨</span></a></h3><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// lib.c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &lt;stdio.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> foobar</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  printf</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Printing form lib.so </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">%d</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, i);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// gcc -shared -fPIC lib.c -o Lib.so</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// Program1.c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Lib.h&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  foobar</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container note"><p class="hint-container-title">æ³¨</p><p>ä¸ºäº†å®ŒæˆåŠ¨æ€é“¾æ¥ï¼Œæœ€å…³é”®çš„è¿˜æ˜¯æ‰€ä¾èµ–çš„ç¬¦å·å’Œç›¸å…³æ–‡ä»¶çš„ä¿¡æ¯ã€‚æˆ‘ä»¬çŸ¥é“åœ¨é™æ€é“¾æ¥ä¸­ï¼Œæœ‰ä¸€ä¸ªä¸“é—¨çš„æ®µå«ç¬¦å·è¡¨&quot;.symtab&quot;(symbol table)ï¼Œé‡Œé¢ä¿å­˜äº†æ‰€æœ‰å…³äºè¯¥ç›®æ ‡æ–‡ä»¶çš„ç¬¦å·çš„å®šä¹‰å’Œå¼•ç”¨ã€‚åŠ¨æ€é“¾æ¥çš„ç¬¦å·è¡¨ç¤ºå’Œé™æ€é“¾æ¥ååˆ†ç›¸ä¼¼ã€‚<a href="http://xn--Program1Lib-h09q83i7z1cn3pw73c1ryceu4d.so" target="_blank" rel="noopener noreferrer">æ¯”å¦‚Program1ç¨‹åºä¾èµ–äºLib.so</a>ï¼Œå¼•ç”¨äº†é‡Œé¢çš„printf()å‡½æ•°ã€‚é‚£ä¹ˆå¯¹äºProgram1æ¥è¯´ï¼Œæˆ‘ä»¬ç§°Program1 <mark>å¯¼å…¥(import)</mark> äº†foobar()å‡½æ•°ï¼Œfoobar()æ˜¯Program1çš„ <mark>å¯¼å…¥å‡½æ•°(import function)</mark> ï¼›è€ŒLib.soå®ƒå®é™…ä¸Šæ˜¯å®šä¹‰äº†foobar()å‡½æ•°ï¼Œå¹¶ä¸”æä¾›ç»™å…¶å®ƒæ¨¡å—ä½¿ç”¨ï¼Œ<a href="http://xn--Lib-ot9d688fwy5a.so" target="_blank" rel="noopener noreferrer">æˆ‘ä»¬ç§°Lib.so</a> <mark>å¯¼å‡º(export)</mark> äº†foobar()å‡½æ•°ï¼Œfoobar()æ˜¯Lib.soçš„ <mark>å¯¼å‡ºå‡½æ•°(export function)</mark> ã€‚å¯¹æ¯”äºè¿™ç§å¯¼å…¥å¯¼å‡ºå‡½æ•°ï¼Œåœ¨é™æ€é“¾æ¥ä¸­å°±ç›¸å½“äºæ™®é€šå‡½æ•°çš„å®šä¹‰å’Œå¼•ç”¨ã€‚<br> ELFä¸­è¡¨ç¤ºè¿™ç§æ¨¡å—é—´ç¬¦å·å¯¼å…¥å¯¼å‡ºçš„å…³ç³»å°±å«åš <mark>åŠ¨æ€ç¬¦å·è¡¨(Dynamic Symbol Table)</mark>ï¼Œå¯¹åº”çš„æ®µåå°±æ˜¯ <mark>&quot;.dynsym&quot;(Dynamic Symbol)</mark>ã€‚ä¸&quot;.symbol&quot;ä¸åŒçš„æ˜¯ï¼Œ&quot;.dynsym&quot;åªä¿å­˜äº†ä¸<mark>åŠ¨æ€é“¾æ¥ç›¸å…³çš„ç¬¦å·</mark>ï¼Œå¯¹äºæ¨¡å—å†…éƒ¨çš„ç¬¦å·ï¼Œæ¯”å¦‚æ˜¯ç§æœ‰å˜é‡åˆ™ä¸ä¿å­˜ã€‚å¾ˆå¤šæ—¶å€™åŠ¨æ€é“¾æ¥çš„æ¨¡å—åŒæ—¶æ‹¥æœ‰&quot;.dynsym&quot;å’Œ&quot;.symtab&quot;ä¸¤ä¸ªè¡¨ï¼Œ&quot;.symtab&quot;ä¸­å¾€å¾€ä¿å­˜äº†æ‰€æœ‰ç¬¦å·ï¼ŒåŒ…æ‹¬&quot;.dynsym&quot;ä¸­çš„ç¬¦å·ã€‚<br> å’Œ&quot;.symtab&quot;ç±»ä¼¼ï¼ŒåŠ¨æ€ç¬¦å·è¡¨ä¹Ÿéœ€è¦ä¸€äº›è¾…åŠ©è¡¨ï¼Œæ¯”å¦‚ç”¨äºä¿å­˜ç¬¦å·åçš„å­—ç¬¦ä¸²è¡¨ã€‚ä»Šå¤©é“¾æ¥æ—¶å«åšå­—ç¬¦ä¸²è¡¨==&quot;.strtab&quot;(string table)<mark>ï¼Œåœ¨è¿™é‡Œå°±æ˜¯</mark>åŠ¨æ€ç¬¦å·å­—ç¬¦ä¸²è¡¨&quot;.dynstr&quot;(Dynamic String Table)<mark>ï¼›ç”±äºåŠ¨æ€é“¾æ¥ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç¨‹åºè¿è¡Œæ—¶æŸ¥æ‰¾ç¬¦å·ï¼Œä¸ºäº†åŠ å¿«ç¬¦å·çš„æŸ¥æ‰¾è¿‡ç¨‹ï¼Œå¾€å¾€è¿˜æœ‰è¾…åŠ©çš„</mark>ç¬¦å·å“ˆå¸Œè¡¨(&quot;.hash&quot;)==ã€‚</p></div><p>ä½¿ç”¨readelfæŸ¥çœ‹ELFæ–‡ä»¶çš„åŠ¨æ€ç¬¦å·è¡¨ä»¥åŠå“ˆå¸Œè¡¨ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;  </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">readelf</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -sD</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Lib.so</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Symbol</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> table</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> contains</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 7</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> entries:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  Num:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    Value</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          Size</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Type</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    Bind</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   Vis</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">      Ndx</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Name</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    0:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0000000000000000</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> NOTYPE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  LOCAL</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  UND</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    1:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0000000000000000</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> NOTYPE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  WEAK</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  UND</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> _ITM_deregisterT[...]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    2:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0000000000000000</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> FUNC</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    GLOBAL</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  UND</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [...]@GLIBC_2.2.5 (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    3:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0000000000000000</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> NOTYPE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  WEAK</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  UND</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> __gmon_start__</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    4:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0000000000000000</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> NOTYPE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  WEAK</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  UND</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> _ITM_registerTMC[...]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    5:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0000000000000000</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> FUNC</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    WEAK</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  UND</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [...]@GLIBC_2.2.5 (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    6:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0000000000001119</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    43</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> FUNC</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    GLOBAL</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DEFAULT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   14</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> foobar</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># .hashä¼¼ä¹å·²ç»ä¸ç”¨äº†</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-4-åŠ¨æ€é“¾æ¥é‡å®šä½è¡¨" tabindex="-1"><a class="header-anchor" href="#_5-4-åŠ¨æ€é“¾æ¥é‡å®šä½è¡¨"><span>5.4 åŠ¨æ€é“¾æ¥é‡å®šä½è¡¨</span></a></h3><p><strong>åŠ¨æ€é“¾æ¥é‡å®šä½ç›¸å…³ç»“æ„</strong><br> å…±äº«å¯¹è±¡çš„é‡å®šä½ä¸é™æ€é“¾æ¥çš„ç›®æ ‡æ–‡ä»¶çš„é‡å®šä½ååˆ†ç±»ä¼¼ã€‚å”¯ä¸€æœ‰åŒºåˆ«çš„æ˜¯ç›®æ ‡æ–‡ä»¶çš„é‡å®šä½æ˜¯ç›®æ ‡æ–‡ä»¶çš„é‡å®šä½æ˜¯åœ¨ä»Šå¤©é“¾æ¥æ—¶å®Œæˆï¼Œè€Œå…±äº«å¯¹è±¡çš„é‡å®šä½åˆ™æ˜¯åœ¨è£…è½½æ—¶å®Œæˆçš„ã€‚åœ¨é™æ€é“¾æ¥ä¸­ï¼Œç›®æ ‡æ–‡ä»¶é‡Œé¢åŒ…å«æœ‰ä¸“é—¨ç”±äºè¡¨ç¤ºé‡å®šä½ä¿¡æ¯çš„é‡å®šä½è¡¨ï¼Œæ¯”å¦‚ <mark>&quot;.rel.text&quot;</mark> è¡¨ç¤ºä»£ç æ®µçš„é‡å®šä½è¡¨ï¼Œ<mark>&quot;.rel.data&quot;</mark> æ˜¯æ•°æ®æ®µçš„é‡å®šä½è¡¨ã€‚<br> åŠ¨æ€é“¾æ¥çš„æ–‡ä»¶ä¸­ï¼Œé‡å®šä½è¡¨åˆ†åˆ«å«åš&quot;.rel.dyn&quot;å’Œ&quot;.rel.plt&quot;ï¼Œä»–ä»¬åˆ†åˆ«ç›¸å½“äº&quot;.rel.text&quot;å’Œ&quot;.rel.data&quot;ã€‚ <mark>&quot;.rel.dyn&quot;</mark> å®é™…ä¸Šæ˜¯å¯¹æ•°æ®å¼•ç”¨çš„ä¿®æ­£ï¼Œå®ƒæ‰€ä¿®æ­£çš„ä½ç½®ä½äº <mark>&quot;.got&quot;ä»¥åŠæ•°æ®æ®µ</mark> ï¼›è€Œ <mark>&quot;.rel.plt&quot;</mark> æ˜¯å¯¹å‡½æ•°å¼•ç”¨çš„ä¿®æ­£ï¼Œå®ƒæ‰€ä¿®æ­£çš„ä½ç½®ä½äº <mark>&quot;.got.plt&quot;</mark> ã€‚</p><p>ä½¿ç”¨readelfæŸ¥çœ‹æ–‡ä»¶çš„é‡å®šä½è¡¨ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">readelf</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Lib.so</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Relocation</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> section</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;.rela.dyn&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> at</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> offset</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x468</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> contains</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 7</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> entries:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  Offset</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          Info</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">           Type</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">           Sym.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Value</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    Sym.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Name</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> +</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Addend</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  000000003e10</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  000000000008</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> R_X86_64_RELATIVE</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">                    1110</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  000000003e18</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  000000000008</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> R_X86_64_RELATIVE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    10d0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  000000004020</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  000000000008</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> R_X86_64_RELATIVE</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">                    4020</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  000000003fe0</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  000100000006</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> R_X86_64_GLOB_DAT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0000000000000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> _ITM_deregisterTM[...]</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  000000003fe8</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  000300000006</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> R_X86_64_GLOB_DAT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0000000000000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> __gmon_start__</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  000000003ff0</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  000400000006</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> R_X86_64_GLOB_DAT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0000000000000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> _ITM_registerTMCl[...]</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  000000003ff8</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  000500000006</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> R_X86_64_GLOB_DAT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0000000000000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> __cxa_finalize@GLIBC_2.2.5</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  Relocation</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> section</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;.rela.plt&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> at</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> offset</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0x510</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> contains</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> entry:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    Offset</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          Info</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">           Type</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">           Sym.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Value</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    Sym.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Name</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> +</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Addend</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    000000004018</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  000200000007</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> R_X86_64_JUMP_SLO</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0000000000000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> printf@GLIBC_2.2.5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">readelf</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -S</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Lib.so</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  [22] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">.got</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">              PROGBITS</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         0000000000003fe0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  00002fe0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">       0000000000000020</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  0000000000000008</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  WA</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">       0</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     0</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     8</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  [23] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">.got.plt</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          PROGBITS</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">         0000000000004000</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  00003000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">       0000000000000020</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  0000000000000008</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  WA</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">       0</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     0</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     8</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  [24] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">.data</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">             PROGBITS</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">         0000000000004020</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  00003020</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">       0000000000000008</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  0000000000000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  WA</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">       0</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     0</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     8</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>R_X86_64_JUMP_SLO(å¯¹.got.pltçš„é‡å®šä½)<br> è¢«ä¿®æ­£çš„ä½ç½®åªéœ€è¦å¡«å…¥ç¬¦å·çš„åœ°å€å³å¯ã€‚ä¾‹å¦‚printfè¿™ä¸ªé‡å®šä½å…¥å£ï¼Œå®ƒçš„ç±»å‹ä¸ºR_X86_64_JUMP_SLOï¼Œå®ƒçš„åç§»ä¸º0x000000004018ï¼Œå®ƒå®é™…ä¸Šä½äº&quot;.got.plt&quot;ä¸­ï¼Œå‰ä¸‰é¡¹è¢«ç³»ç»Ÿå æ®ï¼Œä»ç¬¬å››é¡¹å¼€å§‹å­˜æ”¾å¯¼å…¥å‡½æ•°çš„åœ°æ–¹ã€‚0x0000000000004000 + 8 * 3 = 000000004018ã€‚ <ol><li>ç¬¬ä¸€é¡¹ä¿å­˜çš„æ˜¯&quot;.dynamic&quot;æ®µçš„åœ°å€ã€‚</li><li>ç¬¬äºŒé¡¹ä¿å­˜çš„æ˜¯æœ¬æ¨¡å—çš„IDã€‚</li><li>ç¬¬ä¸‰é¡¹ä¿å­˜çš„æ˜¯_dl_runtime_resolve()çš„åœ°å€ã€‚<br> å½“åŠ¨æ€é“¾æ¥å™¨éœ€è¦è¿›è¡Œé‡å®šä½æ—¶ï¼Œå…ˆæŸ¥æ‰¾&quot;printf&quot;çš„åœ°å€ï¼Œ&quot;printf&quot;ä½äºlibc.so.6ä¸­ã€‚å‡è®¾é“¾æ¥å™¨åœ¨å…¨å±€ç¬¦å·è¡¨é‡Œé¢æ‰¾åˆ°&quot;printf&quot;çš„åœ°å€ä¸º0x000008801234ï¼Œé‚£ä¹ˆé“¾æ¥å™¨å°±ä¼šå°†è¿™ä¸ªåœ°å€å¡«å…¥åˆ°&quot;.got.plt&quot;ä¸­çš„åç§»ä¸º0x000000004018ä½ç½®ä¸­å»ï¼Œä»è€Œå®ç°äº†åœ°å€çš„é‡å®šä½ï¼Œæ—¢å®ç°äº†åŠ¨æ€é“¾æ¥æœ€å…³é”®çš„ä¸€æ­¥ã€‚</li></ol></li><li>R_X86_64_GLOB_DAT(å¯¹.gotçš„é‡å®šä½)<br> å’ŒR_X86_64_JUMP_SLOä¸€æ¨¡ä¸€æ ·ã€‚</li><li>R_X86_64_RELATIVEï¼Œè¿™ç§ç±»å‹çš„é‡å®šä½å®é™…ä¸Šå°±æ˜¯<mark>åŸºå€é‡ç½®(Rebasing)</mark>ã€‚å…±äº«å¯¹è±¡çš„æ•°æ®æ®µæ²¡æœ‰åŠæ³•åšåˆ°åœ°å€æ— å…³çš„ï¼Œå®ƒå¯èƒ½ä¼šåŒ…å«ç»å¯¹åœ°å€å¼•ç”¨ï¼Œå¯¹äºè¿™ç§ç»å¯¹åœ°å€çš„å¼•ç”¨ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨è£…è½½æ—¶å°†å…¶é‡å®šä½ã€‚ä¾‹å¦‚ï¼š<div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> a;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">p </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">a;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div>åœ¨ç¼–è¯‘æ—¶ï¼Œå…±äº«å¯¹è±¡çš„åœ°å€æ˜¯ä»0å¼€å§‹çš„ï¼Œæˆ‘ä»¬å‡è®¾è¯¥é™æ€å˜é‡aç›¸å¯¹äºèµ·å§‹åœ°å€0çš„åç§»ä¸ºBï¼Œå³på€¼ä¸ºBã€‚ä¸€æ—¦å…±äº«å¯¹è±¡è¢«è£…è½½åˆ°åœ°å€Aï¼Œé‚£ä¹ˆå®é™…ä¸Šè¯¥å˜é‡açš„åœ°å€ä¸ºA+Bï¼Œå³pçš„å€¼éœ€è¦åŠ ä¸Šä¸€ä¸ªè£…è½½åœ°å€Aã€‚R_X86_64_RELATIVEç±»å‹çš„é‡å®šä½å…¥å£å°±æ˜¯ä¸“é—¨ç”¨æ¥é‡å®šä½æŒ‡é’ˆå˜é‡pè¿™ç§ç±»å‹çš„ï¼Œå˜é‡påœ¨è£…è½½æ—¶éœ€è¦åŠ ä¸Šä¸€ä¸ªè£…è½½åœ°å€Aï¼Œæ‰æ˜¯æ­£ç¡®çš„ç»“æœã€‚</li></ul><h3 id="_5-5-åŠ¨æ€é“¾æ¥æ—¶è¿›ç¨‹å †æ ˆåˆå§‹åŒ–ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#_5-5-åŠ¨æ€é“¾æ¥æ—¶è¿›ç¨‹å †æ ˆåˆå§‹åŒ–ä¿¡æ¯"><span>5.5 åŠ¨æ€é“¾æ¥æ—¶è¿›ç¨‹å †æ ˆåˆå§‹åŒ–ä¿¡æ¯</span></a></h3><div class="hint-container note"><p class="hint-container-title">æ³¨</p><p>ç«™åœ¨åŠ¨æ€é“¾æ¥å™¨çš„è§’åº¦çœ‹ï¼Œå½“æ“ä½œç³»ç»Ÿå°†æ§åˆ¶æƒäº¤ç»™å®ƒæ—¶ï¼Œå®ƒå°†å¼€å§‹åšé“¾æ¥å·¥ä½œï¼Œé‚£ä¹ˆè‡³å°‘å®ƒéœ€è¦çŸ¥é“å…³äºå¯æ‰§è¡Œæ–‡ä»¶å’Œæœ¬è¿›ç¨‹çš„äº›ä¿¡æ¯ï¼Œæ¯”å¦‚å¯æ‰§è¡Œæ–‡ä»¶æœ‰å‡ ä¸ªæ®µ(&quot;Segment&quot;)ã€æ¯ä¸ªæ®µçš„å±æ€§ã€ç¨‹åºçš„å…¥å£åœ°å€ç­‰ã€‚è¿™äº›ä¿¡æ¯å¾€å¾€ç”±æ“ä½œç³»ç»Ÿä¼ é€’ç»™åŠ¨æ€é“¾æ¥å™¨ï¼Œä¿å­˜åœ¨è¿›ç¨‹çš„å †æ ˆé‡Œé¢ã€‚è¿›ç¨‹åˆå§‹åŒ–æ—¶ï¼Œå †æ ˆé‡Œé¢ä¿å­˜äº†å…³äºè¿›ç¨‹æ‰§è¡Œç¯å¢ƒå’Œå‘½ä»¤è¡Œå‚æ•°ç­‰ä¿¡æ¯ã€‚äº‹å®ä¸Šï¼Œå †æ ˆé‡Œé¢è¿˜ä¿å­˜äº†åŠ¨æ€é“¾æ¥å™¨æ‰€éœ€è¦çš„ä¸€äº›<mark>è¾…åŠ©ä¿¡æ¯æ•°ç»„(Auxiliary Vector)</mark>ã€‚</p></div><p>è¾…åŠ©ä¿¡æ¯ç»“æ„ï¼š</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// /usr/include/elf.h</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">/* Auxiliary vector.  */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">/* This vector is normally only used by the program interpreter.  The</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">   usual definition in an ABI supplement uses the name auxv_t.  The</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">   vector is not usually defined in a standard &lt;elf.h&gt; file, but it</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">   can&#39;t hurt.  We rename it to avoid conflicts.  The sizes of these</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">   types are an arrangement between the exec server and the program</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">   interpreter, so we don&#39;t fully specify them here.  */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> struct</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  uint32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> a_type;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">              /* Entry type */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  union</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      uint32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> a_val;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">           /* Integer value */</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      /* We use to have pointer elements added here.  We cannot do that,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">         though, since it does not work when using 32-bit definitions</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">         on 64-bit platforms and vice versa.  */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } a_un;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">Elf32_auxv_t</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> struct</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  uint64_t</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> a_type;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">              /* Entry type */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  union</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      uint64_t</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> a_val;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">           /* Integer value */</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      /* We use to have pointer elements added here.  We cannot do that,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">         though, since it does not work when using 32-bit definitions</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">         on 64-bit platforms and vice versa.  */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } a_un;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">Elf64_auxv_t</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/image/linker/chapter05/è¾…åŠ©ä¿¡æ¯1.png" alt="" loading="lazy"><br><img src="/image/linker/chapter05/è¾…åŠ©ä¿¡æ¯2.png" alt="" loading="lazy"></p><h2 id="_6-åŠ¨æ€é“¾æ¥çš„æ­¥éª¤å’Œå®ç°" tabindex="-1"><a class="header-anchor" href="#_6-åŠ¨æ€é“¾æ¥çš„æ­¥éª¤å’Œå®ç°"><span>6. åŠ¨æ€é“¾æ¥çš„æ­¥éª¤å’Œå®ç°</span></a></h2><p>åŠ¨æ€é“¾æ¥çš„æ­¥éª¤ï¼š</p><ol><li>å¯åŠ¨åŠ¨æ€é“¾æ¥å™¨æœ¬èº«</li><li>è£…è½½æ‰€æœ‰éœ€è¦çš„å…±äº«å¯¹è±¡</li><li>é‡å®šä½å’Œåˆå§‹åŒ–</li></ol><h3 id="_6-1-åŠ¨æ€é“¾æ¥å™¨è‡ªä¸¾" tabindex="-1"><a class="header-anchor" href="#_6-1-åŠ¨æ€é“¾æ¥å™¨è‡ªä¸¾"><span>6.1 åŠ¨æ€é“¾æ¥å™¨è‡ªä¸¾</span></a></h3><div class="hint-container note"><p class="hint-container-title">æ³¨</p><ol><li>åŠ¨æ€é“¾æ¥å™¨æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå…±äº«å¯¹è±¡ã€‚</li><li>å¯¹äºæ™®é€šå…±äº«å¯¹è±¡æ–‡ä»¶æ¥è¯´ï¼Œå®ƒçš„é‡å®šä½å·¥ä½œç”±åŠ¨æ€é“¾æ¥å™¨æ¥å®Œæˆï¼›å®ƒä¹Ÿå¯ä»¥ä¾èµ–äºå…¶å®ƒå…±äº«å¯¹è±¡ï¼Œå…¶ä¸­çš„è¢«ä¾èµ–çš„å…±äº«å¯¹è±¡æœ‰åŠ¨æ€é“¾æ¥å™¨è´Ÿè´£é“¾æ¥å’Œè£…è½½ã€‚</li><li>å¯¹äºåŠ¨æ€é“¾æ¥å™¨æœ¬èº«ï¼Ÿé¦–å…ˆåŠ¨æ€é“¾æ¥å™¨æœ¬èº«ä¸å¯ä»¥ä¾èµ–äºå…¶å®ƒä»»ä½•å…±äº«å¯¹è±¡ï¼Œå…¶æ¬¡åŠ¨æ€é“¾æ¥å™¨æœ¬èº«æ‰€éœ€è¦çš„å…¨å±€å’Œé™æ€å˜é‡çš„é‡å®šä½å·¥ä½œç”±æœ¬èº«å®Œæˆã€‚å¯¹äºç¬¬ä¸€ä¸ªæ¡ä»¶æˆ‘ä»¬å¯ä»¥äººç‰©çš„æ§åˆ¶ï¼Œåœ¨ç¼–å†™åŠ¨æ€é“¾æ¥å™¨æ—¶ä¿è¯ä¸ä½¿ç”¨ä»»ä½•ç³»ç»Ÿåº“ã€è¿è¡Œåº“ï¼›å¯¹äºç¬¬äºŒä¸ªæ¡ä»¶ï¼ŒåŠ¨æ€é“¾æ¥å™¨å¿…é¡»åœ¨å¯åŠ¨æ—¶æœ‰ä¸€æ®µéå¸¸ç²¾å·§çš„ä»£ç å¯ä»¥å®Œæˆè¿™é¡¹è‰°å·¨çš„å·¥ä½œè€ŒåŒæ—¶åˆä¸èƒ½ä½¿ç”¨å…¨å±€å’Œé™æ€å˜é‡ã€‚è¿™ç§å…·æœ‰ä¸€å®šé™åˆ¶æ¡ä»¶çš„å¯åŠ¨ä»£ç å¾€å¾€è¢«ç§°ä¸º<mark>è‡ªä¸¾ï¼ˆBootstrapï¼‰</mark>ã€‚</li></ol></div><p>åŠ¨æ€é“¾æ¥å™¨å…¥å£åœ°å€å³æ˜¯è‡ªä¸¾ä»£ç å…¥å£ï¼Œå½“æ“ä½œç³»ç»Ÿå°†è¿›ç¨‹æ§åˆ¶æƒäº¤ç»™åŠ¨æ€é“¾æ¥å™¨æ—¶ï¼ŒåŠ¨æ€é“¾æ¥å™¨çš„è‡ªä¸¾ä»£ç å¼€å§‹æ‰§è¡Œã€‚è‡ªä¸¾ä»£ç é¦–å…ˆä¼šæ‰¾åˆ°å®ƒè‡ªå·±çš„GOTã€‚è€ŒGOTçš„ç¬¬ä¸€ä¸ªå…¥å£ä¿å­˜çš„æ˜¯&quot;.dynamic&quot;æ®µçš„åç§»åœ°å€ï¼Œç”±æ­¤æ‰¾åˆ°äº†åŠ¨æ€é“¾æ¥å™¨æœ¬èº«çš„&quot;.dynamic&quot;æ®µã€‚é€šè¿‡&quot;.dynamic&quot;ä¸­çš„ä¿¡æ¯ï¼Œè‡ªä¸¾ä»£ç ä¾¿å¯ä»¥æˆ–å¾—åŠ¨æ€é“¾æ¥å™¨æœ¬èº«çš„é‡å®šä½è¡¨å’Œç¬¦å·è¡¨ç­‰ï¼Œä»è€Œå¾—åˆ°åŠ¨æ€é“¾æ¥å™¨æœ¬èº«çš„é‡å®šä½å…¥å£ï¼Œå…ˆå°†å®ƒä»¬å…¨éƒ¨é‡å®šä½ã€‚ä»è¿™ä¸€æ­¥å¼€å§‹ï¼ŒåŠ¨æ€é“¾æ¥å™¨ä»£ç ä¸­æ‰å¯ä»¥å¼€å§‹ä½¿ç”¨è‡ªå·±çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ã€‚</p><p>å®é™…ä¸ŠåŠ¨æ€é“¾æ¥å™¨çš„è‡ªä¸¾ä»£ç ä¸­ï¼Œé™¤äº†ä¸å¯ä»¥ä½¿ç”¨å…¨å±€å˜é‡å’Œé™æ€å˜é‡ä¹‹å¤–ï¼Œç”šè‡³ä¸èƒ½è°ƒç”¨å‡½æ•°ï¼Œæ—¢åŠ¨æ€é“¾æ¥å™¨æœ¬èº«çš„å‡½æ•°ä¹Ÿä¸èƒ½è°ƒç”¨ã€‚</p><h3 id="_6-2-è£…è½½å…±äº«å¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#_6-2-è£…è½½å…±äº«å¯¹è±¡"><span>6.2 è£…è½½å…±äº«å¯¹è±¡</span></a></h3><div class="hint-container note"><p class="hint-container-title">æ³¨</p><p>å®Œæˆè‡ªä¸¾åï¼ŒåŠ¨æ€é“¾æ¥å™¨å°†å¯æ‰§è¡Œæ–‡ä»¶å’Œé“¾æ¥å™¨æœ¬èº«çš„ç¬¦å·è¡¨éƒ½åˆå¹¶åˆ°ä¸€ä¸ªç¬¦å·è¡¨ä¸­ï¼Œæˆ‘ä»¬ç§°ä¸º<mark>å…¨å±€ç¬¦å·è¡¨ï¼ˆGlobal Symbol Tableï¼‰</mark>ã€‚ç„¶åé“¾æ¥å™¨å¼€å§‹å¯»å€å¯æ‰§è¡Œæ–‡ä»¶æ‰€ä¾èµ–çš„å…±äº«å¯¹è±¡ï¼Œ<mark>åœ¨&quot;.dynamic&quot;æ®µä¸­ï¼Œæœ‰ä¸€ç§ç±»å‹çš„å…¥å£æ˜¯DT_NEEDEDï¼Œå®ƒæ‰€æŒ‡å‡ºçš„æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆæˆ–å…±äº«å¯¹è±¡ï¼‰æ‰€ä¾èµ–çš„å…±äº«å¯¹è±¡</mark>ã€‚ç”±æ­¤ï¼Œé“¾æ¥å™¨å¯ä»¥åˆ—å‡ºå¯æ‰§è¡Œæ–‡ä»¶æ‰€éœ€çš„æ‰€æœ‰å…±äº«å¯¹è±¡å¹¶å°†è¿™äº›å…±äº«å¯¹è±¡çš„åå­—æ”¾å…¥åˆ°ä¸€ä¸ª<mark>è£…è½½é›†åˆä¸­</mark>ã€‚ç„¶åé“¾æ¥å™¨å¼€å§‹ä»é›†åˆä¸­å–ä¸€ä¸ªæ‰€éœ€çš„å…±äº«å¯¹è±¡çš„åå­—ï¼Œ<mark>æ‰¾åˆ°ç›¸åº”çš„æ–‡ä»¶åæ‰“å¼€è¯¥æ–‡ä»¶ï¼Œè¯»å–ç›¸åº”çš„ELFæ–‡ä»¶å¤´å’Œ&quot;.dynamic&quot;æ®µï¼Œç„¶åå°†å®ƒç›¸åº”çš„ä»£ç æ®µå’Œæ•°æ®æ®µæ˜ å°„åˆ°è¿›ç¨‹ç©ºé—´ä¸­</mark>ã€‚å¦‚æœè¿™ä¸ªELFå…±äº«å¯¹è±¡è¿˜ä¾èµ–äºå…¶å®ƒå…±äº«å¯¹è±¡ï¼Œé‚£ä¹ˆå°†æ‰€ä¾èµ–çš„å…±äº«å¯¹è±¡çš„åå­—æ”¾åˆ°è£…è½½é›†åˆä¸­ã€‚å¦‚æ­¤å¾ªç¯ç›´åˆ°æ‰€æœ‰ä¾èµ–çš„å…±äº«å¯¹è±¡éƒ½è¢«è£…è½½å®Œæˆã€‚é“¾æ¥å™¨çš„è£…è½½ä¼šæœ‰ä¸åŒçš„é¡ºåºï¼Œå¯èƒ½ä¼šä½¿ç”¨æ·±åº¦ä¼˜å…ˆæˆ–è€…å¹¿åº¦ä¼˜å…ˆæˆ–è€…å…¶å®ƒçš„é¡ºåºæ¥éå†æ•´ä¸ªé“¾æ¥ï¼Œè¿™å–å†³äºé“¾æ¥å™¨ï¼Œä½†æ˜¯ä¸€èˆ¬æ¯”è¾ƒå¸¸è§çš„ç®—æ³•æ˜¯å¹¿åº¦ä¼˜å…ˆã€‚<br> å½“ä¸€ä¸ªæ–°çš„å…±äº«å¯¹è±¡è¢«è£…è½½å®Œæˆæ—¶ï¼Œå®ƒçš„ç¬¦å·è¡¨ä¼šè¢«åˆå¹¶åˆ°å…¨å±€ç¬¦å·è¡¨ä¸­ï¼Œæ‰€ä»¥å½“æ‰€æœ‰çš„å…±äº«å¯¹è±¡è¢«è£…è½½è¿›æ¥æ—¶ï¼Œå…¨å±€ç¬¦å·è¡¨é‡Œå°†åŒ…å«è¿›ç¨‹ä¸­æ‰€æœ‰çš„åŠ¨æ€é“¾æ¥æ‰€éœ€çš„ç¬¦å·ã€‚</p></div><p><strong>ç¬¦å·çš„ä¼˜å…ˆçº§</strong></p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// a1.c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &lt;stdio.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  printf</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;a1.c</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// a2.c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &lt;stdio.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  printf</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;a2.c</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// b1.c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> b1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// b2.c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> b2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‡è®¾b1.cä¾èµ–äºa1.cï¼Œb2.cä¾èµ–äºa2.c:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">gcc</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -fPIC</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -shared</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> a1.c</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> a1.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">gcc</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -fPIC</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -shared</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> a2.c</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> a2.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">gcc</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -fPIC</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -shared</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> b1.c</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ./a1.so</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> b1.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">gcc</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -fPIC</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -shared</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> b2.c</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ./a2.so</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> b2.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">ldd</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> b1.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        linux-vdso.so.1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (0x00007ffd801db000)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        ./a1.so</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (0x00007f0682435000)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        libc.so.6</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /lib/x86_64-linux-gnu/libc.so.6</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (0x00007f0682203000)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        /lib64/ld-linux-x86-64.so.2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (0x00007f0682441000)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">ldd</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> b2.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        linux-vdso.so.1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (0x00007ffc144a5000)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        ./a2.so</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (0x00007f83a7b6f000)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        libc.so.6</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /lib/x86_64-linux-gnu/libc.so.6</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (0x00007f83a793d000)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        /lib64/ld-linux-x86-64.so.2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (0x00007f83a7b7b000)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‡è®¾æœ‰ç¨‹åºåŒæ—¶ä½¿ç”¨b1.cä¸­çš„å‡½æ•°b1å’Œb2.cä¸­çš„å‡½æ•°b2</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// main.c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &lt;stdio.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> b1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> b2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  b1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  b2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">gcc</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> main.c</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> b1.so</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> b2.so</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> main</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -Xlinker</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -rpath</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ./</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">./main</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">a1.c</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">a1.c</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container note"><p class="hint-container-title">æ³¨</p><p>&quot;-Xlinker -rpath ./&quot;è¡¨ç¤ºé“¾æ¥å™¨åœ¨å½“å‰è·¯å¾„å¯»å€å…±äº«å¯¹è±¡ï¼Œå¦åˆ™é“¾æ¥å™¨ä¼šæŠ¥æ— æ³•æ‰¾åˆ°a1.soå’Œa2.soçš„é”™è¯¯ã€‚</p></div><p>æŸ¥çœ‹è¿›ç¨‹çš„æ˜ å°„ä¿¡æ¯:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /proc/102949/maps</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">55908b687000-55908b688000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1085761</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    /home/far/worker/linker/chapter05/main</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">55908b688000-55908b689000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r-xp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00001000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1085761</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    /home/far/worker/linker/chapter05/main</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">55908b689000-55908b68a000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00002000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1085761</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    /home/far/worker/linker/chapter05/main</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">55908b68a000-55908b68b000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00002000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1085761</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    /home/far/worker/linker/chapter05/main</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">55908b68b000-55908b68c000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rw-p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00003000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1085761</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    /home/far/worker/linker/chapter05/main</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">55908c862000-55908c883000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rw-p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 00:00</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                          [heap]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b68b2000-7ff5b68b4000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rw-p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 00:00</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b68b4000-7ff5b68b5000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1086585</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    /home/far/worker/linker/chapter05/a2.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b68b5000-7ff5b68b6000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r-xp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00001000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1086585</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    /home/far/worker/linker/chapter05/a2.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b68b6000-7ff5b68b7000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00002000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1086585</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    /home/far/worker/linker/chapter05/a2.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b68b7000-7ff5b68b8000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00002000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1086585</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    /home/far/worker/linker/chapter05/a2.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b68b8000-7ff5b68b9000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rw-p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00003000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1086585</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    /home/far/worker/linker/chapter05/a2.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b68b9000-7ff5b68ba000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1086583</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    /home/far/worker/linker/chapter05/a1.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b68ba000-7ff5b68bb000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r-xp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00001000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1086583</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    /home/far/worker/linker/chapter05/a1.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b68bb000-7ff5b68bc000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00002000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1086583</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    /home/far/worker/linker/chapter05/a1.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b68bc000-7ff5b68bd000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00002000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1086583</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    /home/far/worker/linker/chapter05/a1.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b68bd000-7ff5b68be000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rw-p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00003000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1086583</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    /home/far/worker/linker/chapter05/a1.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b68be000-7ff5b68e6000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2774</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                       /usr/lib/x86_64-linux-gnu/libc.so.6</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b68e6000-7ff5b6a7b000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r-xp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00028000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2774</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                       /usr/lib/x86_64-linux-gnu/libc.so.6</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b6a7b000-7ff5b6ad3000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 001bd000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2774</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                       /usr/lib/x86_64-linux-gnu/libc.so.6</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b6ad3000-7ff5b6ad4000</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> ---p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00215000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2774</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                       /usr/lib/x86_64-linux-gnu/libc.so.6</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b6ad4000-7ff5b6ad8000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00215000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2774</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                       /usr/lib/x86_64-linux-gnu/libc.so.6</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b6ad8000-7ff5b6ada000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rw-p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00219000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2774</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                       /usr/lib/x86_64-linux-gnu/libc.so.6</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b6ada000-7ff5b6ae7000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rw-p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 00:00</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b6af0000-7ff5b6af1000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1085852</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    /home/far/worker/linker/chapter05/b2.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b6af1000-7ff5b6af2000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r-xp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00001000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1085852</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    /home/far/worker/linker/chapter05/b2.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b6af2000-7ff5b6af3000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00002000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1085852</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    /home/far/worker/linker/chapter05/b2.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b6af3000-7ff5b6af4000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00002000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1085852</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    /home/far/worker/linker/chapter05/b2.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b6af4000-7ff5b6af5000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rw-p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00003000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1085852</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    /home/far/worker/linker/chapter05/b2.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b6af5000-7ff5b6af6000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1086586</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    /home/far/worker/linker/chapter05/b1.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b6af6000-7ff5b6af7000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r-xp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00001000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1086586</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    /home/far/worker/linker/chapter05/b1.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b6af7000-7ff5b6af8000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00002000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1086586</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    /home/far/worker/linker/chapter05/b1.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b6af8000-7ff5b6af9000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00002000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1086586</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    /home/far/worker/linker/chapter05/b1.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b6af9000-7ff5b6afa000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rw-p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00003000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1086586</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    /home/far/worker/linker/chapter05/b1.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b6afa000-7ff5b6afc000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rw-p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 00:00</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b6afc000-7ff5b6afe000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1173</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                       /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b6afe000-7ff5b6b28000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r-xp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00002000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1173</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                       /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b6b28000-7ff5b6b33000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 0002c000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1173</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                       /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b6b34000-7ff5b6b36000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00037000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1173</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                       /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ff5b6b36000-7ff5b6b38000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rw-p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00039000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fc:03</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1173</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                       /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ffc40a9c000-7ffc40abd000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rw-p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 00:00</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                          [stack]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ffc40b0f000-7ffc40b13000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r--p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 00:00</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                          [vvar]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7ffc40b13000-7ffc40b15000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> r-xp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 00:00</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                          [vdso]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ffffffffff600000-ffffffffff601000</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --xp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00000000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 00:00</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                  [vsyscall]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="http://xn--4a1-j68d3w96kepbv09b3gax454bdbg.so" target="_blank" rel="noopener noreferrer">è§‚å¯Ÿåˆ°4ä¸ªå…±äº«å¯¹è±¡a1.so</a>ã€<a href="http://a2.so" target="_blank" rel="noopener noreferrer">a2.so</a>ã€b1.soä»¥åŠb2.soéƒ½è¢«è£…è½½è¿›æ¥äº†ï¼Œé‚£a1.soçš„å‡½æ•°aå’Œa2.soçš„å‡½æ•°aæ˜¯ä¸æ˜¯å†²çªäº†ï¼Ÿä¸ºä»€ä¹ˆmainçš„è¾“å‡ºç»“æœæ˜¯ä¸¤ä¸ªa1.cå‘¢ï¼Ÿä¹Ÿå°±æ˜¯è¯´a2.soä¸­çš„å‡½æ•°aä¼¼ä¹è¢«å¿½ç•¥äº†ã€‚è¿™ç§ä¸€ä¸ªå…±äº«å¯¹è±¡é‡Œé¢çš„å…¨å±€ç¬¦å·è¢«å¦ä¸€ä¸ªå…±äº«å¯¹è±¡çš„åŒåå…¨å±€ç¬¦å·è¦†ç›–çš„ç°è±¡åˆè¢«ç§°ä¸º<mark>å…±äº«å¯¹è±¡å…¨å±€ç¬¦å·ä»‹å…¥ï¼ˆGlobal Symbol Interposeï¼‰</mark>ã€‚</p><div class="hint-container note"><p class="hint-container-title">æ³¨</p><p>Linuxä¸‹çš„åŠ¨æ€é“¾æ¥å™¨æ—¶è¿™æ ·å¤„ç†å…¨å±€ç¬¦å·ä»‹å…¥çš„ï¼šå½“ä¸€ä¸ªç¬¦å·éœ€è¦è¢«åŠ å…¥å…¨å±€ç¬¦å·è¡¨æ—¶ï¼Œå¦‚æœç›¸åŒçš„ç¬¦å·åå·²ç»å­˜åœ¨ï¼Œåˆ™ååŠ å…¥çš„ç¬¦å·å¿½ç•¥ã€‚<br> è¿™ä¸€ç‚¹å·²ç»è¯´æ˜äº†ä¸ºä»€ä¹ˆ ä¼šæ‰“å°å‡ºä¸¤ä¸ªa1.cçš„åŸå› è£…è½½çš„é¡ºåºåº”è¯¥æ˜¯(<a href="http://xn--b1-062c6uq1ge3wife6i.so" target="_blank" rel="noopener noreferrer">å¯¹äºå¹¿åº¦ä¼˜å…ˆb1.so</a>ã€<a href="http://b2.so" target="_blank" rel="noopener noreferrer">b2.so</a>ã€<a href="http://a1.xn--soa2-121g.so" target="_blank" rel="noopener noreferrer">a1.soå’Œa2.so</a>ï¼Œå¯¹äºæ·±åº¦ä¼˜å…ˆï¼š<a href="http://b1.so" target="_blank" rel="noopener noreferrer">b1.so</a>ã€<a href="http://a1.so" target="_blank" rel="noopener noreferrer">a1.so</a>ã€<a href="http://b2.xn--soa2-121g.so" target="_blank" rel="noopener noreferrer">b2.soå’Œa2.so</a>)å› æ­¤a2.soçš„åŒåç¬¦å·ä¸€å®šä¼šè¢«å¿½ç•¥ã€‚</p></div><div class="hint-container important"><p class="hint-container-title">é‡è¦</p><p>åŒæ ·å› ä¸ºå…¨å±€ç¬¦å·ä»‹å…¥çš„é—®é¢˜ï¼Œå¯¼è‡´ä¸ºä»€ä¹ˆæ¨¡å—å†…éƒ¨è°ƒç”¨é&quot;static&quot;å‡½æ•°æ—¶ä¸ºä»€ä¹ˆä¹Ÿè¦ä½¿ç”¨åœ°å€æ— å…³ä»£ç ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç›¸å¯¹åœ°å€è°ƒç”¨çš„åŸå› ã€‚å› ä¸ºä¸€æ—¦å‡ºç°å…¨å±€ç¬¦å·ä»‹å…¥å°±éœ€è¦ä¿®æ”¹å…¶è°ƒç”¨åœ°å€ã€‚</p></div><h3 id="_6-3-é‡å®šä½å’Œåˆå§‹åŒ–" tabindex="-1"><a class="header-anchor" href="#_6-3-é‡å®šä½å’Œåˆå§‹åŒ–"><span>6.3 é‡å®šä½å’Œåˆå§‹åŒ–</span></a></h3><p>å½“ä¸Šé¢çš„æ­¥éª¤å®Œæˆåï¼Œé“¾æ¥å™¨å¼€å§‹é‡æ–°éå†å¯æ‰§è¡Œæ–‡ä»¶å’Œæ¯ä¸ªå…±äº«å¯¹è±¡çš„é‡å®šä½è¡¨ï¼Œå°†å®ƒä»¬çš„GOT/PLTä¸­çš„æ¯ä¸ªéœ€è¦é‡å®šä½çš„ä½ç½®è¿›è¡Œä¿®æ­£ã€‚</p><p>é‡å®šä½å®Œæˆåï¼Œå¦‚æœæŸä¸ªå…±äº«å¯¹è±¡æœ‰&quot;.init&quot;æ®µï¼Œé‚£ä¹ˆåŠ¨æ€é“¾æ¥å™¨ä¼šæ‰§è¡Œ&quot;.init&quot;æ®µä¸­çš„ä»£ç ï¼Œç”¨ä»¥å®ç°å…±äº«å¯¹è±¡ç‰¹æœ‰çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œæ¯”å¦‚å…±äº«å¯¹è±¡ä¸­çš„c++çš„å…¨å±€/é™æ€å¯¹è±¡çš„æ„é€ å°±éœ€è¦é€šè¿‡&quot;.init&quot;æ¥åˆå§‹åŒ–ã€‚ç›¸åº”çš„ï¼Œå…±äº«åº“ä¸­è¿˜å¯èƒ½æœ‰&quot;.finit&quot;æ®µï¼Œå½“è¿›ç¨‹é€€å‡ºæ—¶ä¼šæ‰§è¡Œ&quot;.finit&quot;æ®µä¸­çš„ä»£ç ï¼Œæ¯”å¦‚ç”¨æ¥å®ç°c++å…¨å±€å¯¹è±¡ææ„ä¹‹ç±»çš„æ“ä½œã€‚</p><p>å¯¹äºå¯æ‰§è¡Œæ–‡ä»¶è€Œè¨€&quot;.init&quot;æ®µå’Œ&quot;.finit&quot;æ®µæ˜¯ç”±ç¨‹åºåˆå§‹åŒ–éƒ¨åˆ†ä»£ç è´Ÿè´£æ‰§è¡Œçš„ã€‚</p><p>å½“å®Œæˆäº†é‡å®šä½å’Œåˆå§‹åŒ–åï¼Œæ‰€æœ‰çš„å‡†å¤‡å·¥ä½œå°±å®£å‘Šå®Œæˆäº†ï¼Œæ‰€éœ€è¦çš„å…±äº«å¯¹è±¡ä¹Ÿéƒ½å·²ç»è£…è½½å¹¶ä¸”é“¾æ¥å®Œæˆï¼Œè¿™æ—¶åŠ¨æ€é“¾æ¥å™¨å°†è¿›ç¨‹çš„æ§åˆ¶æƒäº¤ç»™ç¨‹åºçš„å…¥å£å¹¶ä¸”å¼€å§‹æ‰§è¡Œã€‚</p><h2 id="_7-åº“æ‰“æ¡©æœºåˆ¶-hook" tabindex="-1"><a class="header-anchor" href="#_7-åº“æ‰“æ¡©æœºåˆ¶-hook"><span>7. åº“æ‰“æ¡©æœºåˆ¶(HOOK)</span></a></h2><p>Linuxé“¾æ¥å™¨æ”¯æŒä¸€ç§å¼ºå¤§çš„æŠ€æœ¯ï¼Œå®ƒå…è®¸ä½ åŠ«æŒå¯¹å…±äº«åº“å‡½æ•°çš„è°ƒç”¨ï¼Œå–è€Œä»£ä¹‹æ‰§è¡Œè‡ªå·±çš„ä»£ç ã€‚</p><p>ä»¥å¯¹libcåº“çš„mallocå’Œfreeä¸ºä¾‹:</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// mymalloc.c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#ifdef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> COMPILETIME</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &lt;malloc.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &lt;stdio.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mymalloc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  void</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">ptr </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> malloc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(size);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  printf</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;malloc(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">)=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">%p</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)size, ptr);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ptr;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> myfree</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">ptr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  free</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(ptr);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  printf</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;free(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">%p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">)</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, ptr);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// malloc.h</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#ifndef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> __MALLOC_H__</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> __MALLOC_H__</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &lt;stdlib.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> malloc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mymalloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(size)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> free</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">ptr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">myfree</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(ptr)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mymalloc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> free</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">ptr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//int.c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &lt;malloc.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &lt;stdio.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  int</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">p </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> malloc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  free</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(p);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-1-ç¼–è¯‘æ—¶æ‰“æ¡©" tabindex="-1"><a class="header-anchor" href="#_7-1-ç¼–è¯‘æ—¶æ‰“æ¡©"><span>7.1 ç¼–è¯‘æ—¶æ‰“æ¡©</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">gcc</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -DCOMPILETIME</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mymalloc.c</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">gcc</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -I.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> intc</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> int.c</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mymalloc.o</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">./intc</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">malloc(32</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)=0x560a72b382a0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">free(0x560a72b382a0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»ç»“æœä¸Šçœ‹ï¼Œä½¿ç”¨äº†æˆ‘ä»¬è‡ªå®šä¹‰çš„mallocå’Œfreeå‡½æ•°ã€‚å…¶ä¸»è¦åŸå› æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨ç¼–è¯‘å¯æ‰§è¡Œç¨‹åºæ—¶ä½¿ç”¨äº†-I .ï¼Œè¿™ä¸ªé€‰é¡¹ä¼šå‘Šè¯‰cçš„é¢„å¤„ç†å™¨åœ¨æœç´¢ç³»ç»Ÿç›®å½•å‰ï¼Œå…ˆåœ¨å½“å‰ç›®å½•ä¸­æŸ¥æ‰¾malloc.hã€‚éœ€è¦æ³¨æ„çš„æ˜¯mymalloc.hä¸­çš„åŒ…è£…å‡½æ•°ä½¿ç”¨çš„æ ‡å¿—malloc.hå¤´æ–‡ä»¶ç¼–è¯‘çš„ã€‚</p><h3 id="_7-2-é“¾æ¥æ—¶æ‰“æ¡©" tabindex="-1"><a class="header-anchor" href="#_7-2-é“¾æ¥æ—¶æ‰“æ¡©"><span>7.2 é“¾æ¥æ—¶æ‰“æ¡©</span></a></h3><p>å¯¹mymalloc.cæ–‡ä»¶è¿›è¡Œä¿®æ”¹å¾—åˆ°å¦‚ä¸‹æºç ï¼š</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// link_malloc.c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#ifdef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> LINKTIME</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &lt;stdio.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">__real_malloc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> __real_free</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">ptr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">__wrap_malloc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  void</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">ptr </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> __real_malloc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(size);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  printf</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;malloc(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">) = </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">%p</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)size, ptr);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ptr;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> __wrap_free</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">ptr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  __real_free</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(ptr);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  printf</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;free(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">%p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">)</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, ptr);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#endif</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">gcc</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -DLINKTIME</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> link_malloc.c</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">gcc</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> int.c</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">gcc</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -Wl,--wrap,malloc</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -Wl,--wrap,free</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> intl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> int.o</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> link_malloc.o</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">./intl</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">malloc(32</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) = 0x5590c014a2a0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">free(0x5590c014a2a0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container important"><p class="hint-container-title">é‡è¦</p><p>Linuxé™æ€é“¾æ¥å™¨æ”¯æŒç”¨--wrap fæ ‡å¿—è¿›è¡Œé“¾æ—¶æ‰“æ¡©ã€‚è¿™ä¸ªæ ‡å¿—å‘Šè¯‰é“¾æ¥å™¨ï¼ŒæŠŠå¯¹ç¬¦å·fçš„å¼•ç”¨è§£ææˆ__wrap_fï¼Œè¿˜è¦å¯¹ç¬¦å·__real_fçš„å¼•ç”¨è§£æä½fã€‚<br> -Wl, optioné€‰é¡¹è¡¨ç¤ºæŠŠoptionä¼ é€’ç»™é“¾æ¥å™¨ã€‚optionä¸­çš„æ¯ä¸ªé€—å·éƒ½è¦æ›¿æ¢ä¸ºä¸€ä¸ªç©ºæ ¼ã€‚æ‰€ä»¥-Wl,--wrap,mallocå°±æŠŠ--wrap mallocä¼ é€’ç»™é“¾æ¥å™¨ï¼Œ-Wl,--wrap,freeä¹Ÿç±»ä¼¼ã€‚</p></div><h3 id="_7-3-è¿è¡Œæ—¶æ‰“æ¡©" tabindex="-1"><a class="header-anchor" href="#_7-3-è¿è¡Œæ—¶æ‰“æ¡©"><span>7.3 è¿è¡Œæ—¶æ‰“æ¡©</span></a></h3><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// run_malloc.c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#ifdef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> RUNTIME</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> _GNU_SOURCE</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &lt;dlfcn.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &lt;unistd.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &lt;stdio.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &lt;stdlib.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">malloc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  void</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">mallocp)(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">size_t</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  char</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">error;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  mallocp </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> dlsym</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(RTLD_NEXT, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;malloc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ((error </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> dlerror</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    fputs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(error, stderr);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    exit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  void</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">ptr </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> mallocp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(size);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  char</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;"> buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">256</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  snprintf</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(buffer, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(buffer), </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;malloc(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">) = </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">%p</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)size, ptr);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(STDERR_FILENO, buffer, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(buffer));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ptr;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> free</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">ptr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  void</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">freep)(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  char</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">error;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  freep </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> dlsym</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(RTLD_NEXT, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;free&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ((error </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> dlerror</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    fputs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(error, stderr);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    exit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  freep</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(ptr);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  char</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;"> buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">256</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  snprintf</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(buffer, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(buffer), </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;free(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">%p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">)</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, ptr);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(STDERR_FILENO, buffer, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(buffer));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#endif</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">gcc</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -shared</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -fPIC</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -DRUNTIME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> run_malloc.c</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> run_malloc.so</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -ldl</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">gcc</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> intr</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> int.c</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ./run_malloc.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">./intr</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">malloc(32</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) = 0x563142b312a0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">free(0x563142b312a0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/hncat/edit/main/src/cs/linker/chapter05.md" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: v19991123v@163.com">far</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/cs/linker/chapter04.html" aria-label="ç¬¬å››ç«  å¯æ‰§è¡Œæ–‡ä»¶çš„è£…è½½"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->ç¬¬å››ç«  å¯æ‰§è¡Œæ–‡ä»¶çš„è£…è½½</div></a><!----></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><!----><div class="vp-copyright">Copyright Â© 2025 Mr.far </div></footer></div><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script src="/assets/js/runtime~app.4f498ec4.js" defer></script><script src="/assets/js/5783.f27e5b5a.js" defer></script><script src="/assets/js/app.9a5769b4.js" defer></script>
  </body>
</html>
